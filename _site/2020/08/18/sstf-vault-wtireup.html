<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="https://gmpg.org/xfn/11" rel="profile" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />

  <title>
    
      Samsung CTF App Reverse Eng. Writeup (Detailed) &middot; Saket Upadhyay
    
  </title>

  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-163708069-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() { dataLayer.push(arguments); }
  gtag('js', new Date());

  gtag('config', 'UA-163708069-1');
</script>


  <!-- CSS -->
  <link rel="stylesheet" href="/assets/css/main.css" />
  

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface" />

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/favicon.png" />
<link rel="shortcut icon" href="/favicon.ico" />

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml" />

  <!-- Additional head bits without overriding original head -->
</head>


  <body class="post">

    <div id="sidebar">
  <header>
    <div class="site-title">
      <a>
        
          <span class="back-arrow icon"><svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
  <path d="M0 0h24v24H0z" fill="none"/>
  <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
</svg></span>
        
        Saket Upadhyay
      </a>
    </div>
    <p class="lead">Cybersecurity Student. Security Researcher Wannabe. </p>
  </header>
  <nav id="sidebar-nav-links">
  
    <a class="home-link "
        href="/">Home</a>
  
  

  

  


  
    
  

  
    
      <a class="page-link "
          href="/about.html">About Me</a>
    
  

  
    
      <a class="page-link "
          href="/btoc.html">Index</a>
    
  

  
    
  

  

  
    
  

  
    
      <a class="page-link "
          href="/projects.html">Projects</a>
    
  

  
    
  

  
    
      <a class="page-link "
          href="/publications.html">Publications</a>
    
  

  
    
  

  
    
      <a class="page-link "
          href="/topics.html">Topics</a>
    
  

  

  
    
  

  

  
    
  

  

  
    
  

  
    
  

  
    
  

  

  


  


  
    
  

  
    
  

  
    
  

  
    
  

  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  

  
    
  

  

  
    
  

  

  
    
  

  
    
  

  
    
  

  

  


  <!-- Optional additional links to insert in sidebar nav -->
</nav>


  <!--  -->

  <nav id="sidebar-icon-links">
  <!--  -->



    <a id="github-link" class="icon" title="Github" aria-label="Github"
      href="https://github.com/Saket-Upadhyay">
      <svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 28" height="24" width="28"><path d="M12 2c6.625 0 12 5.375 12 12 0 5.297-3.437 9.797-8.203 11.391-0.609 0.109-0.828-0.266-0.828-0.578 0-0.391 0.016-1.687 0.016-3.297 0-1.125-0.375-1.844-0.812-2.219 2.672-0.297 5.484-1.313 5.484-5.922 0-1.313-0.469-2.375-1.234-3.219 0.125-0.313 0.531-1.531-0.125-3.187-1-0.313-3.297 1.234-3.297 1.234-0.953-0.266-1.984-0.406-3-0.406s-2.047 0.141-3 0.406c0 0-2.297-1.547-3.297-1.234-0.656 1.656-0.25 2.875-0.125 3.187-0.766 0.844-1.234 1.906-1.234 3.219 0 4.594 2.797 5.625 5.469 5.922-0.344 0.313-0.656 0.844-0.766 1.609-0.688 0.313-2.438 0.844-3.484-1-0.656-1.141-1.844-1.234-1.844-1.234-1.172-0.016-0.078 0.734-0.078 0.734 0.781 0.359 1.328 1.75 1.328 1.75 0.703 2.141 4.047 1.422 4.047 1.422 0 1 0.016 1.937 0.016 2.234 0 0.313-0.219 0.688-0.828 0.578-4.766-1.594-8.203-6.094-8.203-11.391 0-6.625 5.375-12 12-12zM4.547 19.234c0.031-0.063-0.016-0.141-0.109-0.187-0.094-0.031-0.172-0.016-0.203 0.031-0.031 0.063 0.016 0.141 0.109 0.187 0.078 0.047 0.172 0.031 0.203-0.031zM5.031 19.766c0.063-0.047 0.047-0.156-0.031-0.25-0.078-0.078-0.187-0.109-0.25-0.047-0.063 0.047-0.047 0.156 0.031 0.25 0.078 0.078 0.187 0.109 0.25 0.047zM5.5 20.469c0.078-0.063 0.078-0.187 0-0.297-0.063-0.109-0.187-0.156-0.266-0.094-0.078 0.047-0.078 0.172 0 0.281s0.203 0.156 0.266 0.109zM6.156 21.125c0.063-0.063 0.031-0.203-0.063-0.297-0.109-0.109-0.25-0.125-0.313-0.047-0.078 0.063-0.047 0.203 0.063 0.297 0.109 0.109 0.25 0.125 0.313 0.047zM7.047 21.516c0.031-0.094-0.063-0.203-0.203-0.25-0.125-0.031-0.266 0.016-0.297 0.109s0.063 0.203 0.203 0.234c0.125 0.047 0.266 0 0.297-0.094zM8.031 21.594c0-0.109-0.125-0.187-0.266-0.172-0.141 0-0.25 0.078-0.25 0.172 0 0.109 0.109 0.187 0.266 0.172 0.141 0 0.25-0.078 0.25-0.172zM8.937 21.438c-0.016-0.094-0.141-0.156-0.281-0.141-0.141 0.031-0.234 0.125-0.219 0.234 0.016 0.094 0.141 0.156 0.281 0.125s0.234-0.125 0.219-0.219z"></path>
</svg>

    </a>
  <a id="linkedin-link" class="icon" title="Linked-In" aria-label="Linked-In" href="https://www.linkedin.com/in/saketupadhyay/">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/></svg>
  </a>

  <a id="twitter-link" class="icon" title="Twitter" aria-label="Twitter" href="https://twitter.com/x64mayhem">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-.139 9.237c.209 4.617-3.234 9.765-9.33 9.765-1.854 0-3.579-.543-5.032-1.475 1.742.205 3.48-.278 4.86-1.359-1.437-.027-2.649-.976-3.066-2.28.515.098 1.021.069 1.482-.056-1.579-.317-2.668-1.739-2.633-3.26.442.246.949.394 1.486.411-1.461-.977-1.875-2.907-1.016-4.383 1.619 1.986 4.038 3.293 6.766 3.43-.479-2.053 1.08-4.03 3.199-4.03.943 0 1.797.398 2.395 1.037.748-.147 1.451-.42 2.086-.796-.246.767-.766 1.41-1.443 1.816.664-.08 1.297-.256 1.885-.517-.439.656-.996 1.234-1.639 1.697z"/></svg>
  </a>


  <!-- <a id="subscribe-link"
     class="icon" title="Subscribe" aria-label="Subscribe"
     href="/feed.xml">
    <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <circle cx="6.18" cy="17.82" r="2.18"/>
    <path d="M4 4.44v2.83c7.03 0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9 0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/>
</svg>
  </a> -->

  
  
  
  

<a id="research-link"
       class="icon"
       title="Tags" aria-label="Tags"
       href="https://orcid.org/0000-0003-0574-7843">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M20.759 20.498c-2.342-3.663-5.575-6.958-5.743-11.498h-2.016c.173 5.212 3.512 8.539 5.953 12.356.143.302-.068.644-.377.644h-1.264l-4.734-7h-3.52c.873-1.665 1.85-3.414 1.936-6h-2.01c-.169 4.543-3.421 7.864-5.743 11.498-.165.347-.241.707-.241 1.057 0 1.283 1.023 2.445 2.423 2.445h13.153c1.4 0 2.424-1.162 2.424-2.446 0-.35-.076-.709-.241-1.056zm-4.759-15.498c0 1.105-.896 2-2 2s-2-.895-2-2 .896-2 2-2 2 .895 2 2zm-5-1.5c0 .829-.672 1.5-1.5 1.5s-1.5-.671-1.5-1.5.672-1.5 1.5-1.5 1.5.671 1.5 1.5zm0 3.5c0 .552-.447 1-1 1s-1-.448-1-1 .447-1 1-1 1 .448 1 1zm3-6c0 .552-.447 1-1 1s-1-.448-1-1 .447-1 1-1 1 .448 1 1z"/></svg>
</a>

  <a id="email-link" class="icon" title="Tags" aria-label="Tags" href="mailto:x64mayhem@gmail.com">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 12.713l-11.985-9.713h23.971l-11.986 9.713zm-5.425-1.822l-6.575-5.329v12.501l6.575-7.172zm10.85 0l6.575 7.172v-12.501l-6.575 5.329zm-1.557 1.261l-3.868 3.135-3.868-3.135-8.11 8.848h23.956l-8.11-8.848z"/></svg>
  </a>

<!-- <a id="search-link"
       class="icon"
       title="Search" aria-label="Search"
       href="/search.html">
      <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
    <path d="M0 0h24v24H0z" fill="none"/>
</svg>
</a> -->
<a id="key-link" class="icon"  aria-label="PGP"
  href="/pubkey.html">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12.451 17.337l-2.451 2.663h-2v2h-2v2h-6v-5l6.865-6.949c1.08 2.424 3.095 4.336 5.586 5.286zm11.549-9.337c0 4.418-3.582 8-8 8s-8-3.582-8-8 3.582-8 8-8 8 3.582 8 8zm-3-3c0-1.104-.896-2-2-2s-2 .896-2 2 .896 2 2 2 2-.896 2-2z"/></svg>
</a>

  <!-- Optional additional links to insert for icons links -->
</nav>

  <p>
  <!-- &copy; 2020.
  <a href="/LICENSE.md">MIT License.</a> -->
</p>

</div>

    <main class="container">
      <header>
  <h1 class="post-title">Samsung CTF App Reverse Eng. Writeup (Detailed)</h1>
</header>
<div class="content">
  <div class="post-meta">
  <span class="post-date">18 Aug 2020</span>
  <span class="post-categories">
    
  </span>
</div>


  <div class="post-body">
    <div class="message">
A writeup of Reverse Engineering Challenge of Samsung CTF "Hacker's Playground 2020"
<br />
Points : 500
<br />
Solves : 15
</div>

<h3 id="background">Background</h3>

<p><img src="/assets/images/sctf/banner.png" alt="" /></p>

<p>I took part in Samsung’s CTF event and tried to do some reverse engineering challenges, I was able to solve one but the sad part is i got the flag 1 min. after timeout so the points were not added :(</p>

<p>Anyways this post is about my approach to the solution and the things learned from the challenge, so let’s get into that.</p>

<h3 id="what-we-get-as-a-question">What we get as a question.</h3>
<p>A file named <code class="language-plaintext highlighter-rouge">Vault101.0.1-release.apk</code> and a banner saying <code class="language-plaintext highlighter-rouge">Can you get the password?</code></p>

<h4 id="brief">Brief</h4>
<p>The main goal of this challenge is <code class="language-plaintext highlighter-rouge">Security in obscurity is not enough</code> and we will get to know this as this application is heavily obfuscated and encrypted. But the weakness being once you understand the working and decode the obfuscation the data and the key is hardcoded and are not being obtained by some server or Keystore.</p>

<p>That being said let’s get into the analysis. My approach in this is majorly Static Analysis and we will be using some custom scripts to recreate encryption algorithms. So this is gonna be long and detailed, I also wrote a smaller and compact version on Medium for all the people who don’t have enough time in life. <a href="https://medium.com/@saketupadhyay/vault-101-samsung-ctf-android-reverse-engineering-challenge-write-up-d5a2b16a9212">READ IT HERE IF YOU ARE ONE OF THEM</a></p>

<h3 id="decompilation-and-initial-analysis">Decompilation and Initial Analysis</h3>
<p><img src="/assets/images/sctf/ldt.jpg" alt="" />
We can decompile the application via anything we feel comfortable with, I chose <code class="language-plaintext highlighter-rouge">JADX</code> as this gives reasonable java code for the android application with the usable directory structure.</p>

<p>After decompilation, the first step is pretty usual for everyone I think and that is <em>finding the Main.java</em> file as this is usually responsible for initial code of the application <em>(and complication</em></p>

<p>So after decompilation we got the following structure and it’s generally easy to find the <code class="language-plaintext highlighter-rouge">Main.java</code> at <code class="language-plaintext highlighter-rouge">./source/com/vendorname/.../Main.java</code> and that works here too as we are greeted with the files below :
We found ours at <code class="language-plaintext highlighter-rouge">sources/com/sctf2020/vault101/</code></p>

<p><img src="/assets/images/sctf/mainfile.png" alt="" /></p>

<p>And here is <code class="language-plaintext highlighter-rouge">Main.java</code> :</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.sctf2020.vault101</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">a.b.k.e</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="n">e</span> <span class="kd">implements</span> <span class="nc">OnClickListener</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="nc">EditText</span> <span class="n">p</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nc">Button</span> <span class="n">q</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nc">AnimatedVectorDrawable</span> <span class="n">r</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">volatile</span> <span class="n">b</span><span class="o">.</span><span class="na">c</span><span class="o">.</span><span class="na">a</span><span class="o">.</span><span class="na">b</span> <span class="n">s</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nc">ServiceConnection</span> <span class="n">t</span> <span class="o">=</span> <span class="k">new</span> <span class="n">a</span><span class="o">();</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">a</span> <span class="kd">implements</span> <span class="nc">ServiceConnection</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="nf">a</span><span class="o">()</span> <span class="o">{}</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onServiceConnected</span><span class="o">(</span><span class="nc">ComponentName</span> <span class="n">componentName</span><span class="o">,</span> <span class="nc">IBinder</span> <span class="n">iBinder</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">MainActivity</span><span class="o">.</span><span class="na">this</span><span class="o">.</span><span class="na">s</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="na">c</span><span class="o">.</span><span class="na">a</span><span class="o">.</span><span class="na">b</span><span class="o">.</span><span class="na">a</span><span class="o">.</span><span class="na">b</span><span class="o">(</span><span class="n">iBinder</span><span class="o">);</span>
            <span class="nc">MainActivity</span> <span class="n">mainActivity</span> <span class="o">=</span> <span class="nc">MainActivity</span><span class="o">.</span><span class="na">this</span><span class="o">;</span>
            <span class="n">mainActivity</span><span class="o">.</span><span class="na">q</span><span class="o">.</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="n">mainActivity</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onServiceDisconnected</span><span class="o">(</span><span class="nc">ComponentName</span> <span class="n">componentName</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">MainActivity</span><span class="o">.</span><span class="na">this</span><span class="o">.</span><span class="na">s</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
            <span class="nc">MainActivity</span><span class="o">.</span><span class="na">this</span><span class="o">.</span><span class="na">q</span><span class="o">.</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="kc">null</span><span class="o">);}}</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">b</span> <span class="kd">implements</span> <span class="nc">TextWatcher</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="nf">b</span><span class="o">()</span> <span class="o">{}</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">afterTextChanged</span><span class="o">(</span><span class="nc">Editable</span> <span class="n">editable</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">MainActivity</span><span class="o">.</span><span class="na">this</span><span class="o">.</span><span class="na">q</span><span class="o">.</span><span class="na">setEnabled</span><span class="o">(</span><span class="n">editable</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">beforeTextChanged</span><span class="o">(</span><span class="nc">CharSequence</span> <span class="n">charSequence</span><span class="o">,</span> <span class="kt">int</span> <span class="n">i</span><span class="o">,</span> <span class="kt">int</span> <span class="n">i2</span><span class="o">,</span> <span class="kt">int</span> <span class="n">i3</span><span class="o">)</span> <span class="o">{}</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onTextChanged</span><span class="o">(</span><span class="nc">CharSequence</span> <span class="n">charSequence</span><span class="o">,</span> <span class="kt">int</span> <span class="n">i</span><span class="o">,</span> <span class="kt">int</span> <span class="n">i2</span><span class="o">,</span> <span class="kt">int</span> <span class="n">i3</span><span class="o">)</span> <span class="o">{}</span>
<span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="nc">View</span> <span class="n">view</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="kt">boolean</span> <span class="n">a2</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">s</span><span class="o">.</span><span class="na">a</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">p</span><span class="o">.</span><span class="na">getText</span><span class="o">().</span><span class="na">toString</span><span class="o">());</span>
            <span class="nc">Toast</span> <span class="n">toast</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Toast</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
            <span class="n">toast</span><span class="o">.</span><span class="na">setView</span><span class="o">(</span><span class="n">getLayoutInflater</span><span class="o">().</span><span class="na">inflate</span><span class="o">(</span><span class="n">a2</span> <span class="o">?</span> <span class="no">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">toast_success_layout</span> <span class="o">:</span> <span class="no">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">toast_fail_layout</span><span class="o">,</span> <span class="o">(</span><span class="nc">ViewGroup</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">custom_toast_container</span><span class="o">)));</span>
            <span class="n">toast</span><span class="o">.</span><span class="na">setGravity</span><span class="o">(</span><span class="mi">17</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
            <span class="n">toast</span><span class="o">.</span><span class="na">setDuration</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
            <span class="n">toast</span><span class="o">.</span><span class="na">show</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(!</span><span class="n">a2</span><span class="o">)</span> <span class="o">{</span><span class="k">this</span><span class="o">.</span><span class="na">p</span><span class="o">.</span><span class="na">getText</span><span class="o">().</span><span class="na">clear</span><span class="o">();}</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">RemoteException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span><span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();}</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="nc">Bundle</span> <span class="n">bundle</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">bundle</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">((</span><span class="kt">int</span><span class="o">)</span> <span class="no">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">q</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Button</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">button</span><span class="o">);</span>
        <span class="nc">EditText</span> <span class="n">editText</span> <span class="o">=</span> <span class="o">(</span><span class="nc">EditText</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">editText</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">p</span> <span class="o">=</span> <span class="n">editText</span><span class="o">;</span>
        <span class="n">editText</span><span class="o">.</span><span class="na">addTextChangedListener</span><span class="o">(</span><span class="k">new</span> <span class="n">b</span><span class="o">());</span>
        <span class="nc">AnimatedVectorDrawable</span> <span class="n">animatedVectorDrawable</span> <span class="o">=</span> <span class="o">(</span><span class="nc">AnimatedVectorDrawable</span><span class="o">)</span> <span class="o">((</span><span class="nc">ImageView</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">imageView</span><span class="o">)).</span><span class="na">getDrawable</span><span class="o">();</span>
        <span class="k">this</span><span class="o">.</span><span class="na">r</span> <span class="o">=</span> <span class="n">animatedVectorDrawable</span><span class="o">;</span>
        <span class="n">animatedVectorDrawable</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="n">bindService</span><span class="o">(</span><span class="k">new</span> <span class="nc">Intent</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="nc">VaultService</span><span class="o">.</span><span class="na">class</span><span class="o">),</span> <span class="k">this</span><span class="o">.</span><span class="na">t</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onDestroy</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onDestroy</span><span class="o">();</span>
        <span class="n">unbindService</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">t</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onResume</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onResume</span><span class="o">();</span>
        <span class="k">this</span><span class="o">.</span><span class="na">r</span><span class="o">.</span><span class="na">start</span><span class="o">();}}</span>
</code></pre></div></div>

<p><em>I have Removed the import part to save space</em></p>

<p>After a brief walkthrough over code, we can see how we get our <code class="language-plaintext highlighter-rouge">GOOD PASSWORD</code> or <code class="language-plaintext highlighter-rouge">BAD PASSWORD</code> messages.
Check out this part :</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">try</span> <span class="o">{</span>
            <span class="kt">boolean</span> <span class="n">a2</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">s</span><span class="o">.</span><span class="na">a</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">p</span><span class="o">.</span><span class="na">getText</span><span class="o">().</span><span class="na">toString</span><span class="o">());</span>
            <span class="nc">Toast</span> <span class="n">toast</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Toast</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
            <span class="n">toast</span><span class="o">.</span><span class="na">setView</span><span class="o">(</span><span class="n">getLayoutInflater</span><span class="o">().</span><span class="na">inflate</span><span class="o">(</span><span class="n">a2</span> <span class="o">?</span> <span class="no">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">toast_success_layout</span> <span class="o">:</span> <span class="no">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">toast_fail_layout</span><span class="o">,</span> <span class="o">(</span><span class="nc">ViewGroup</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">custom_toast_container</span><span class="o">)));</span>
            <span class="n">toast</span><span class="o">.</span><span class="na">setGravity</span><span class="o">(</span><span class="mi">17</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
            <span class="n">toast</span><span class="o">.</span><span class="na">setDuration</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
            <span class="n">toast</span><span class="o">.</span><span class="na">show</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(!</span><span class="n">a2</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">this</span><span class="o">.</span><span class="na">p</span><span class="o">.</span><span class="na">getText</span><span class="o">().</span><span class="na">clear</span><span class="o">();</span>
            <span class="o">}</span>

</code></pre></div></div>

<p>So when we get <code class="language-plaintext highlighter-rouge">true</code> from <code class="language-plaintext highlighter-rouge">boolean function this.s.a()</code> we say password is accepted.</p>

<p>Also note that you won’t find any <code class="language-plaintext highlighter-rouge">s\a.java</code> in the folder structure because see this :</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">volatile</span> <span class="n">b</span><span class="o">.</span><span class="na">c</span><span class="o">.</span><span class="na">a</span><span class="o">.</span><span class="na">b</span> <span class="n">s</span><span class="o">;</span>
</code></pre></div></div>

<p>It’s actually <code class="language-plaintext highlighter-rouge">b.c.a.b.a()</code> .</p>

<p>So let’s go analyze all these crazy functions…</p>

<h3 id="deep-analysis-and-finding-obfuscation">Deep Analysis and Finding Obfuscation</h3>

<p><img src="/assets/images/sctf/deep.jpg" alt="" /></p>

<p>Let’s analyze all the functions, the plan is simple we will go branch by branch, i.e. :</p>
<blockquote>
  <p>first analysis function X and if it calls Y we will go and check Y and come back when it returns.</p>
</blockquote>

<p>So back to our class <code class="language-plaintext highlighter-rouge">b.c.a.b</code>’s function <code class="language-plaintext highlighter-rouge">a()</code> :</p>

<p>This is out <code class="language-plaintext highlighter-rouge">b.java</code></p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">b.c.a</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.Binder</span><span class="o">;</span><span class="kn">import</span> <span class="nn">android.os.IBinder</span><span class="o">;</span><span class="kn">import</span> <span class="nn">android.os.IInterface</span><span class="o">;</span><span class="kn">import</span> <span class="nn">android.os.Parcel</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">b</span> <span class="kd">extends</span> <span class="nc">IInterface</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">a</span> <span class="kd">extends</span> <span class="nc">Binder</span> <span class="kd">implements</span> <span class="n">b</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">C0039a</span> <span class="kd">implements</span> <span class="n">b</span> <span class="o">{</span>
            <span class="kd">public</span> <span class="nc">IBinder</span> <span class="n">f822a</span><span class="o">;</span>
            <span class="kd">public</span> <span class="nf">C0039a</span><span class="o">(</span><span class="nc">IBinder</span> <span class="n">iBinder</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">this</span><span class="o">.</span><span class="na">f822a</span> <span class="o">=</span> <span class="n">iBinder</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">a</span><span class="o">(</span><span class="nc">String</span> <span class="n">str</span><span class="o">)</span> <span class="o">{</span>
                <span class="nc">Parcel</span> <span class="n">obtain</span> <span class="o">=</span> <span class="nc">Parcel</span><span class="o">.</span><span class="na">obtain</span><span class="o">();</span>
                <span class="nc">Parcel</span> <span class="n">obtain2</span> <span class="o">=</span> <span class="nc">Parcel</span><span class="o">.</span><span class="na">obtain</span><span class="o">();</span>
                <span class="k">try</span> <span class="o">{</span>
                    <span class="n">obtain</span><span class="o">.</span><span class="na">writeInterfaceToken</span><span class="o">(</span><span class="s">"com.sctf2020.vault101.IVault"</span><span class="o">);</span>
                    <span class="n">obtain</span><span class="o">.</span><span class="na">writeString</span><span class="o">(</span><span class="n">str</span><span class="o">);</span>
                    <span class="kt">boolean</span> <span class="n">z</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
                    <span class="k">this</span><span class="o">.</span><span class="na">f822a</span><span class="o">.</span><span class="na">transact</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">obtain</span><span class="o">,</span> <span class="n">obtain2</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
                    <span class="n">obtain2</span><span class="o">.</span><span class="na">readException</span><span class="o">();</span>
                    <span class="k">if</span> <span class="o">(</span><span class="n">obtain2</span><span class="o">.</span><span class="na">readInt</span><span class="o">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span><span class="n">z</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;}</span>
                    <span class="k">return</span> <span class="n">z</span><span class="o">;</span>
                <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
                    <span class="n">obtain2</span><span class="o">.</span><span class="na">recycle</span><span class="o">();</span>
                    <span class="n">obtain</span><span class="o">.</span><span class="na">recycle</span><span class="o">();}}</span>
            <span class="kd">public</span> <span class="nc">IBinder</span> <span class="nf">asBinder</span><span class="o">()</span> <span class="o">{</span><span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">f822a</span><span class="o">;}}</span>
        <span class="kd">public</span> <span class="nf">a</span><span class="o">()</span> <span class="o">{</span><span class="n">attachInterface</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="s">"com.sctf2020.vault101.IVault"</span><span class="o">);}</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="n">b</span> <span class="nf">b</span><span class="o">(</span><span class="nc">IBinder</span> <span class="n">iBinder</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">iBinder</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span><span class="k">return</span> <span class="kc">null</span><span class="o">;}</span>
            <span class="nc">IInterface</span> <span class="n">queryLocalInterface</span> <span class="o">=</span> <span class="n">iBinder</span><span class="o">.</span><span class="na">queryLocalInterface</span><span class="o">(</span><span class="s">"com.sctf2020.vault101.IVault"</span><span class="o">);</span>
            <span class="k">return</span> <span class="o">(</span><span class="n">queryLocalInterface</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="o">!(</span><span class="n">queryLocalInterface</span> <span class="k">instanceof</span> <span class="n">b</span><span class="o">))</span> <span class="o">?</span> <span class="k">new</span> <span class="nc">C0039a</span><span class="o">(</span><span class="n">iBinder</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">b</span><span class="o">)</span> <span class="n">queryLocalInterface</span><span class="o">;</span>
      <span class="o">}</span>
        <span class="kd">public</span> <span class="nc">IBinder</span> <span class="nf">asBinder</span><span class="o">()</span> <span class="o">{</span><span class="k">return</span> <span class="k">this</span><span class="o">;}</span>
        <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">inTransact</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">,</span> <span class="nc">Parcel</span> <span class="n">parcel</span><span class="o">,</span> <span class="nc">Parcel</span> <span class="n">parcel2</span><span class="o">,</span> <span class="kt">int</span> <span class="n">i2</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">String</span> <span class="n">str</span> <span class="o">=</span> <span class="s">"com.sctf2020.vault101.IVault"</span><span class="o">;</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">parcel</span><span class="o">.</span><span class="na">enforceInterface</span><span class="o">(</span><span class="n">str</span><span class="o">);</span>
                <span class="kt">boolean</span> <span class="n">a2</span> <span class="o">=</span> <span class="n">a</span><span class="o">(</span><span class="n">parcel</span><span class="o">.</span><span class="na">readString</span><span class="o">());</span>
                <span class="n">parcel2</span><span class="o">.</span><span class="na">writeNoException</span><span class="o">();</span>
                <span class="n">parcel2</span><span class="o">.</span><span class="na">writeInt</span><span class="o">(</span><span class="n">a2</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="o">);</span>
                <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">!=</span> <span class="mi">1598968902</span><span class="o">){</span><span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">onTransact</span><span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">parcel</span><span class="o">,</span> <span class="n">parcel2</span><span class="o">,</span> <span class="n">i2</span><span class="o">);}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="n">parcel2</span><span class="o">.</span><span class="na">writeString</span><span class="o">(</span><span class="n">str</span><span class="o">);</span><span class="k">return</span> <span class="kc">true</span><span class="o">;}}}</span>
 <span class="kt">boolean</span> <span class="nf">a</span><span class="o">(</span><span class="nc">String</span> <span class="n">str</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>so we called <code class="language-plaintext highlighter-rouge">a(String _ourinput_)</code> so this implimentation of <code class="language-plaintext highlighter-rouge">a()</code> in class <code class="language-plaintext highlighter-rouge">b.java</code> will be called :</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">a</span><span class="o">(</span><span class="nc">String</span> <span class="n">str</span><span class="o">)</span> <span class="o">{</span>
                <span class="nc">Parcel</span> <span class="n">obtain</span> <span class="o">=</span> <span class="nc">Parcel</span><span class="o">.</span><span class="na">obtain</span><span class="o">();</span>
                <span class="nc">Parcel</span> <span class="n">obtain2</span> <span class="o">=</span> <span class="nc">Parcel</span><span class="o">.</span><span class="na">obtain</span><span class="o">();</span>
                <span class="k">try</span> <span class="o">{</span>
                    <span class="n">obtain</span><span class="o">.</span><span class="na">writeInterfaceToken</span><span class="o">(</span><span class="s">"com.sctf2020.vault101.IVault"</span><span class="o">);</span>
                    <span class="n">obtain</span><span class="o">.</span><span class="na">writeString</span><span class="o">(</span><span class="n">str</span><span class="o">);</span>
                    <span class="kt">boolean</span> <span class="n">z</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
                    <span class="k">this</span><span class="o">.</span><span class="na">f822a</span><span class="o">.</span><span class="na">transact</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">obtain</span><span class="o">,</span> <span class="n">obtain2</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
                    <span class="n">obtain2</span><span class="o">.</span><span class="na">readException</span><span class="o">();</span>
                    <span class="k">if</span> <span class="o">(</span><span class="n">obtain2</span><span class="o">.</span><span class="na">readInt</span><span class="o">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
				 <span class="n">z</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                    <span class="o">}</span>
                    <span class="k">return</span> <span class="n">z</span><span class="o">;</span>
                <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
                    <span class="n">obtain2</span><span class="o">.</span><span class="na">recycle</span><span class="o">();</span>
                    <span class="n">obtain</span><span class="o">.</span><span class="na">recycle</span><span class="o">();}</span>
            <span class="kd">public</span> <span class="nc">IBinder</span> <span class="nf">asBinder</span><span class="o">()</span> <span class="o">{</span><span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">f822a</span><span class="o">;}}</span>
</code></pre></div></div>
<p>Which is just using <code class="language-plaintext highlighter-rouge">Parcel</code> to obtain the string and the app token to pass the data via <code class="language-plaintext highlighter-rouge">transact</code></p>

<p>So let’s observe <code class="language-plaintext highlighter-rouge">onTransact</code></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onTransact</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">,</span> <span class="nc">Parcel</span> <span class="n">parcel</span><span class="o">,</span> <span class="nc">Parcel</span> <span class="n">parcel2</span><span class="o">,</span> <span class="kt">int</span> <span class="n">i2</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">String</span> <span class="n">str</span> <span class="o">=</span> <span class="s">"com.sctf2020.vault101.IVault"</span><span class="o">;</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">parcel</span><span class="o">.</span><span class="na">enforceInterface</span><span class="o">(</span><span class="n">str</span><span class="o">);</span>
                <span class="kt">boolean</span> <span class="n">a2</span> <span class="o">=</span> <span class="n">a</span><span class="o">(</span><span class="n">parcel</span><span class="o">.</span><span class="na">readString</span><span class="o">());</span>
                <span class="n">parcel2</span><span class="o">.</span><span class="na">writeNoException</span><span class="o">();</span>
                <span class="n">parcel2</span><span class="o">.</span><span class="na">writeInt</span><span class="o">(</span><span class="n">a2</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="o">);</span>
                <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>

<span class="o">...</span>
</code></pre></div></div>

<p>Here we also see if we pass <code class="language-plaintext highlighter-rouge">int 1</code> and then our 2 parcels, it will call</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kt">boolean</span> <span class="n">a2</span> <span class="o">=</span> <span class="n">a</span><span class="o">(</span><span class="n">parcel</span><span class="o">.</span><span class="na">readString</span><span class="o">());</span>
</code></pre></div></div>
<p>Now this is <code class="language-plaintext highlighter-rouge">function a()</code> of extended <code class="language-plaintext highlighter-rouge">a()</code> in <code class="language-plaintext highlighter-rouge">VaultService.java</code> so let’s check that out.</p>

<h5 id="vaultservicejava--encrypted-class-extends-bcaba">VaultService.java : Encrypted Class Extends b.c.a.b.a()</h5>

<p><code class="language-plaintext highlighter-rouge">VaultService.java</code> extends <code class="language-plaintext highlighter-rouge">a(String str)</code> which is the new functionality invoked in previous :</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kt">boolean</span> <span class="n">a2</span> <span class="o">=</span> <span class="n">a</span><span class="o">(</span><span class="n">parcel</span><span class="o">.</span><span class="na">readString</span><span class="o">());</span>
</code></pre></div></div>

<p>So let’s have a look at <code class="language-plaintext highlighter-rouge">VaultService.java</code></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.sctf2020.vault101</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">android.app.Service</span><span class="o">;</span><span class="kn">import</span> <span class="nn">android.content.Intent</span><span class="o">;</span><span class="kn">import</span> <span class="nn">android.os.IBinder</span><span class="o">;</span><span class="kn">import</span> <span class="nn">java.lang.reflect.Array</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">b.c.a.c</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">VaultService</span> <span class="kd">extends</span> <span class="nc">Service</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="nc">IBinder</span> <span class="n">f873b</span> <span class="o">=</span> <span class="k">new</span> <span class="n">b</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">b</span> <span class="kd">extends</span> <span class="n">b</span><span class="o">.</span><span class="na">c</span><span class="o">.</span><span class="na">a</span><span class="o">.</span><span class="na">b</span><span class="o">.</span><span class="na">a</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="n">f874a</span><span class="o">;</span>
        <span class="kd">public</span> <span class="nf">b</span><span class="o">(</span><span class="n">a</span> <span class="n">aVar</span><span class="o">)</span> <span class="o">{}</span>
        <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">a</span><span class="o">(</span><span class="nc">String</span> <span class="n">str</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">f874a</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span>
                <span class="k">this</span><span class="o">.</span><span class="na">f874a</span> <span class="o">=</span> <span class="n">i</span><span class="o">;</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="o">)</span> <span class="o">{</span>
                    <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">";È\u0003p¯4Å¶orÂ\"Ý\u0010|"</span><span class="o">,</span> <span class="o">-</span><span class="mi">500953648</span><span class="o">)).</span><span class="na">getMethod</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"qó%"</span><span class="o">,</span> <span class="mi">991422357</span><span class="o">),</span> <span class="k">new</span> <span class="nc">Class</span><span class="o">[]{(</span><span class="nc">Class</span><span class="o">)</span> <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"~jxe\u0005reíY:Bè`niaY"</span><span class="o">,</span> <span class="mi">1069257791</span><span class="o">)).</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"\u0001ò¬\u0010"</span><span class="o">,</span> <span class="mi">1659367412</span><span class="o">)).</span><span class="na">get</span><span class="o">(</span><span class="kc">null</span><span class="o">)}).</span><span class="na">invoke</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">[]{</span><span class="nc">Integer</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="mi">0</span><span class="o">)});</span>
                    <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
                <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">str</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                    <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
                <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                    <span class="kt">byte</span><span class="o">[]</span> <span class="n">b2</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="na">c</span><span class="o">.</span><span class="na">a</span><span class="o">.</span><span class="na">a</span><span class="o">.</span><span class="na">b</span><span class="o">((</span><span class="kt">byte</span><span class="o">[])</span> <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">".Â®$\u000fß1Ç\u0003?Ú6Ê¶\""</span><span class="o">,</span> <span class="mi">1451800421</span><span class="o">)).</span><span class="na">getMethod</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"7Ì£\u0002rØ0X"</span><span class="o">,</span> <span class="o">-</span><span class="mi">552283301</span><span class="o">),</span> <span class="k">new</span> <span class="nc">Class</span><span class="o">[</span><span class="mi">0</span><span class="o">]).</span><span class="na">invoke</span><span class="o">(</span><span class="n">str</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">[</span><span class="mi">0</span><span class="o">]));</span>
                    <span class="nc">Object</span> <span class="n">invoke</span> <span class="o">=</span> <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"aogrfle¯}qjì.Cbsl35"</span><span class="o">,</span> <span class="mi">823239689</span><span class="o">)).</span><span class="na">getMethod</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"$OX{Í\u0010"</span><span class="o">,</span> <span class="o">-</span><span class="mi">2050089752</span><span class="o">),</span> <span class="k">new</span> <span class="nc">Class</span><span class="o">[]{</span><span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"\u000eé"</span><span class="o">,</span> <span class="mi">937562454</span><span class="o">)),</span> <span class="o">(</span><span class="nc">Class</span><span class="o">)</span> <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">";HCp¯\u0005tå¶ohõ%LRtó"</span><span class="o">,</span> <span class="o">-</span><span class="mi">730536752</span><span class="o">)).</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"\u0014ø¡\u0014"</span><span class="o">,</span> <span class="o">-</span><span class="mi">1215097919</span><span class="o">)).</span><span class="na">get</span><span class="o">(</span><span class="kc">null</span><span class="o">)}).</span><span class="na">invoke</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">[]{</span><span class="n">b2</span><span class="o">,</span> <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"pç\u000bfÆ´!\rÌ!BZ?Ë\u000egÌëq"</span><span class="o">,</span> <span class="o">-</span><span class="mi">1393972808</span><span class="o">)).</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"\u001aä\u0017Yï\u0004"</span><span class="o">,</span> <span class="mi">1778992991</span><span class="o">)).</span><span class="na">get</span><span class="o">(</span><span class="kc">null</span><span class="o">)});</span>
                    <span class="nc">Object</span> <span class="n">newInstance</span> <span class="o">=</span> <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"~jxe\u0005remY:Xrfb`c"</span><span class="o">,</span> <span class="mi">1356052543</span><span class="o">)).</span><span class="na">getConstructor</span><span class="o">(</span><span class="k">new</span> <span class="nc">Class</span><span class="o">[]{</span><span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"[C"</span><span class="o">,</span> <span class="mi">591904395</span><span class="o">))}).</span><span class="na">newInstance</span><span class="o">(</span><span class="k">new</span> <span class="nc">Object</span><span class="o">[]{</span><span class="n">invoke</span><span class="o">});</span>
                    <span class="nc">Object</span> <span class="n">invoke2</span> <span class="o">=</span> <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"$Í\u001efÆ4\u0007:EH Í\u000e:ê&gt;]-_"</span><span class="o">,</span> <span class="o">-</span><span class="mi">248372756</span><span class="o">)).</span><span class="na">getMethod</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"&amp;DÇ\u0003ÿ\u0016xg¬"</span><span class="o">,</span> <span class="mi">64103114</span><span class="o">),</span> <span class="k">new</span> <span class="nc">Class</span><span class="o">[]{(</span><span class="nc">Class</span><span class="o">)</span> <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"/BNt\u001fqç`ó1F_pÓ"</span><span class="o">,</span> <span class="o">-</span><span class="mi">401453852</span><span class="o">)).</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"\u0001ò\u0004D"</span><span class="o">,</span> <span class="mi">195131734</span><span class="o">)).</span><span class="na">get</span><span class="o">(</span><span class="kc">null</span><span class="o">)}).</span><span class="na">invoke</span><span class="o">(</span><span class="nc">VaultService</span><span class="o">.</span><span class="na">this</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">[]{</span><span class="nc">Integer</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">magic</span><span class="o">)});</span>
                    <span class="k">return</span> <span class="o">((</span><span class="nc">Boolean</span><span class="o">)</span> <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"zhs`-ddmu.Rwb`kf"</span><span class="o">,</span> <span class="o">-</span><span class="mi">754317293</span><span class="o">)).</span><span class="na">getMethod</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"tø\u001auÅ®"</span><span class="o">,</span> <span class="mi">528601528</span><span class="o">),</span> <span class="k">new</span> <span class="nc">Class</span><span class="o">[]{</span><span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"oâ5º!OÈzä\u0016oæ "</span><span class="o">,</span> <span class="o">-</span><span class="mi">1620091986</span><span class="o">))}).</span><span class="na">invoke</span><span class="o">(</span><span class="n">invoke2</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">[]{</span><span class="n">newInstance</span><span class="o">})).</span><span class="na">booleanValue</span><span class="o">();</span>
                <span class="o">}</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Throwable</span> <span class="n">unused</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="nc">IBinder</span> <span class="nf">onBind</span><span class="o">(</span><span class="nc">Intent</span> <span class="n">intent</span><span class="o">)</span> <span class="o">{</span><span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">f873b</span><span class="o">;}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">Object</span> <span class="n">invoke</span> <span class="o">=</span> <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"0Gqsn@q¥2noÿ4Ga/BF{ÿ4yu"</span><span class="o">,</span> <span class="mi">1132272720</span><span class="o">)).</span><span class="na">getMethod</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"bf~VNeoô]wn÷"</span><span class="o">,</span> <span class="mi">1545475118</span><span class="o">),</span> <span class="k">new</span> <span class="nc">Class</span><span class="o">[</span><span class="mi">0</span><span class="o">]).</span><span class="na">invoke</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
            <span class="nc">Object</span> <span class="n">invoke2</span> <span class="o">=</span> <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"!Ï#î5£.Ï%Ïó\"$Ò5Ó4ò"</span><span class="o">,</span> <span class="mi">354045889</span><span class="o">)).</span><span class="na">getMethod</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"#Fä\u0012uQyç#@ó»%Z"</span><span class="o">,</span> <span class="mi">1074255429</span><span class="o">),</span> <span class="k">new</span> <span class="nc">Class</span><span class="o">[]{(</span><span class="nc">Class</span><span class="o">)</span> <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"ê1§£%Íúkêaî5û"</span><span class="o">,</span> <span class="o">-</span><span class="mi">72994916</span><span class="o">)).</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"\u0010zBE"</span><span class="o">,</span> <span class="mi">1821340751</span><span class="o">)).</span><span class="na">get</span><span class="o">(</span><span class="kc">null</span><span class="o">)}).</span><span class="na">invoke</span><span class="o">(</span><span class="n">invoke</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">[]{</span><span class="nc">Integer</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">array</span><span class="o">.</span><span class="na">kind_of_magic</span><span class="o">)});</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">invoke2</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="kt">int</span> <span class="n">length</span> <span class="o">=</span> <span class="nc">Array</span><span class="o">.</span><span class="na">getLength</span><span class="o">(</span><span class="n">invoke2</span><span class="o">);</span>
                <span class="kt">byte</span><span class="o">[]</span> <span class="n">bArr</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="n">length</span><span class="o">];</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                    <span class="nc">Object</span> <span class="n">obj</span> <span class="o">=</span> <span class="nc">Array</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">invoke2</span><span class="o">,</span> <span class="n">i</span><span class="o">);</span>
                    <span class="nc">Object</span> <span class="n">invoke3</span> <span class="o">=</span> <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"uå&amp;Ä· \rË Â\u001a:É'Îèp"</span><span class="o">,</span> <span class="mi">446383039</span><span class="o">)).</span><span class="na">getMethod</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">" Fñ/mB"</span><span class="o">,</span> <span class="mi">825348685</span><span class="o">),</span> <span class="k">new</span> <span class="nc">Class</span><span class="o">[]{</span><span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"+À§ -Ì0Ç$.Ò3È¿&amp;"</span><span class="o">,</span> <span class="mi">1167863618</span><span class="o">)),</span> <span class="o">(</span><span class="nc">Class</span><span class="o">)</span> <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"?Ê¨%\u0007Ó5E\u001a;Â\u0000!Î¹!["</span><span class="o">,</span> <span class="o">-</span><span class="mi">521211012</span><span class="o">)).</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"\u0010zè\u0010"</span><span class="o">,</span> <span class="o">-</span><span class="mi">1491966233</span><span class="o">)).</span><span class="na">get</span><span class="o">(</span><span class="kc">null</span><span class="o">)}).</span><span class="na">invoke</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">[]{</span><span class="n">obj</span><span class="o">,</span> <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"$M^fÆ\u001et§!Bðka[gÌA$"</span><span class="o">,</span> <span class="o">-</span><span class="mi">1048288020</span><span class="o">)).</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"\nlÇ\u0012qs@"</span><span class="o">,</span> <span class="mi">282303079</span><span class="o">)).</span><span class="na">get</span><span class="o">(</span><span class="kc">null</span><span class="o">)});</span>
                    <span class="nc">String</span> <span class="n">d</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="na">d</span><span class="o">((</span><span class="nc">CharSequence</span><span class="o">)</span> <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">";HÁ1§\u0001te¾kð.#@Ù7"</span><span class="o">,</span> <span class="o">-</span><span class="mi">158782760</span><span class="o">)).</span><span class="na">getConstructor</span><span class="o">(</span><span class="k">new</span> <span class="nc">Class</span><span class="o">[]{</span><span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"JË"</span><span class="o">,</span> <span class="mi">543344920</span><span class="o">))}).</span><span class="na">newInstance</span><span class="o">(</span><span class="k">new</span> <span class="nc">Object</span><span class="o">[]{</span><span class="n">invoke3</span><span class="o">}),</span> <span class="n">i</span> <span class="o">^</span> <span class="mi">137</span><span class="o">);</span>
                    <span class="n">bArr</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="o">(</span><span class="kt">byte</span><span class="o">)</span> <span class="o">((</span><span class="nc">Character</span><span class="o">)</span> <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"k`Õ1¥(`oìjð$shÍ7"</span><span class="o">,</span> <span class="mi">25375370</span><span class="o">)).</span><span class="na">getMethod</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"wã\u000ffè«"</span><span class="o">,</span> <span class="o">-</span><span class="mi">375635523</span><span class="o">),</span> <span class="k">new</span> <span class="nc">Class</span><span class="o">[]{(</span><span class="nc">Class</span><span class="o">)</span> <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"oâ6`/ï!Ob/HOqæ'ds"</span><span class="o">,</span> <span class="mi">1759650052</span><span class="o">)).</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"\u0000rÌ\u0000"</span><span class="o">,</span> <span class="mi">575374967</span><span class="o">)).</span><span class="na">get</span><span class="o">(</span><span class="kc">null</span><span class="o">)}).</span><span class="na">invoke</span><span class="o">(</span><span class="n">d</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">[]{</span><span class="nc">Integer</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="mi">0</span><span class="o">)})).</span><span class="na">charValue</span><span class="o">();</span>
                <span class="o">}</span>
                <span class="n">b</span><span class="o">.</span><span class="na">c</span><span class="o">.</span><span class="na">a</span><span class="o">.</span><span class="na">a</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getDeclaredFields</span><span class="o">()[</span><span class="mi">0</span><span class="o">].</span><span class="na">set</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="n">bArr</span><span class="o">);</span>
                <span class="k">return</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">NullPointerException</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Throwable</span> <span class="n">unused</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>And yes, that’s where the actual headache starts! All the above class is encoded… but we see some significant leads, and here they are :</p>

<ul>
  <li>This includes b.c.a.a class</li>
  <li>We have multiple instance of <code class="language-plaintext highlighter-rouge">Class.forName()</code>, <code class="language-plaintext highlighter-rouge">invoke()</code> and <code class="language-plaintext highlighter-rouge">.getMethod()</code> calls</li>
  <li>function <code class="language-plaintext highlighter-rouge">d()</code> of class c.java is used with varying variables passed.</li>
</ul>

<h4 id="getmethod-classforname-and-invoke">GetMethod(), Class.forName() and Invoke()</h4>

<p>On searching in java Docs (yes it exists) we can see that the <code class="language-plaintext highlighter-rouge">GetClass()</code> will actually do what it says…. gets the class by name and it is the same for others.</p>

<p>SO HERE’S THE DEAL :</p>

<blockquote>
  <p>If I say <strong>object = GetClass(“System”).getMethod(“out”).getMethod(“println”)</strong>
And then I do <strong>object.invoke(null,new Object String(“HELLO WORLD”))</strong>
I am actually doing : <strong>System.out.println(“HELLO WORLD”);</strong></p>
</blockquote>

<p>So they are building their intended code by passing names of class which they are decoding somehow via <code class="language-plaintext highlighter-rouge">d()</code> function in <code class="language-plaintext highlighter-rouge">c.java</code></p>

<p>AAAAAAAAAAAAAAAHHHHHHHHHHHHHHHHHHHHHHHH……..</p>

<p>OKAY now let’s check <code class="language-plaintext highlighter-rouge">d()</code>.</p>

<h4 id="custom-encryption-in-the-app">Custom encryption in the app.</h4>

<p>so basically the <code class="language-plaintext highlighter-rouge">c.java</code> is the class responsible for all general encryption in the app. It’s the main source of the obfuscation in all the major library calls.</p>

<p>Let’s C <code class="language-plaintext highlighter-rouge">C.java</code> hehe you saw what I did there.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">b.c.a</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">c</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">f823a</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">char</span> <span class="nf">a</span><span class="o">(</span><span class="kt">char</span> <span class="n">c</span><span class="o">,</span> <span class="kt">int</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="o">(</span><span class="kt">char</span><span class="o">)</span> <span class="o">(</span><span class="n">c</span> <span class="o">&amp;</span> <span class="o">((</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="o">)</span> <span class="o">^</span> <span class="mi">65535</span><span class="o">));</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">char</span> <span class="nf">b</span><span class="o">(</span><span class="kt">char</span> <span class="n">c</span><span class="o">,</span> <span class="kt">int</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="o">(</span><span class="kt">char</span><span class="o">)</span> <span class="o">(</span><span class="n">c</span> <span class="o">|</span> <span class="o">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="o">));</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">char</span> <span class="nf">c</span><span class="o">(</span><span class="kt">char</span> <span class="n">c</span><span class="o">,</span> <span class="kt">int</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="o">(</span><span class="kt">char</span><span class="o">)</span> <span class="o">((</span><span class="n">c</span> <span class="o">&amp;</span> <span class="o">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="o">))</span> <span class="o">&gt;&gt;</span> <span class="n">i</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">d</span><span class="o">(</span><span class="nc">CharSequence</span> <span class="n">charSequence</span><span class="o">,</span> <span class="kt">int</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">StringBuilder</span> <span class="n">sb</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">sb</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i2</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i2</span> <span class="o">&lt;</span> <span class="n">charSequence</span><span class="o">.</span><span class="na">length</span><span class="o">();</span> <span class="n">i2</span><span class="o">++)</span> <span class="o">{</span>
            <span class="kt">char</span> <span class="n">charAt</span> <span class="o">=</span> <span class="n">charSequence</span><span class="o">.</span><span class="na">charAt</span><span class="o">(</span><span class="n">i2</span><span class="o">);</span>
            <span class="kt">char</span> <span class="n">c</span> <span class="o">=</span> <span class="o">(</span><span class="kt">char</span><span class="o">)</span> <span class="o">(</span><span class="n">i</span> <span class="o">&gt;&gt;</span> <span class="o">(</span><span class="n">i2</span> <span class="o">%</span> <span class="mi">4</span><span class="o">));</span>
            <span class="kt">int</span> <span class="n">i3</span> <span class="o">=</span> <span class="n">i2</span> <span class="o">%</span> <span class="mi">3</span><span class="o">;</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">i3</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i4</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i4</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="o">;</span> <span class="n">i4</span> <span class="o">+=</span> <span class="mi">2</span><span class="o">)</span> <span class="o">{</span>
                    <span class="kt">char</span> <span class="n">c2</span> <span class="o">=</span> <span class="n">c</span><span class="o">(</span><span class="n">charAt</span><span class="o">,</span> <span class="n">i4</span><span class="o">)</span> <span class="o">^</span> <span class="n">c</span><span class="o">(</span><span class="n">c</span><span class="o">,</span> <span class="n">i4</span><span class="o">);</span>
                    <span class="k">if</span> <span class="o">(</span><span class="n">c2</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">charAt</span> <span class="o">=</span> <span class="n">a</span><span class="o">(</span><span class="n">charAt</span><span class="o">,</span> <span class="n">i4</span><span class="o">);</span>
                    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">c2</span> <span class="o">==</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">charAt</span> <span class="o">=</span> <span class="n">b</span><span class="o">(</span><span class="n">charAt</span><span class="o">,</span> <span class="n">i4</span><span class="o">);</span>
                    <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">i3</span> <span class="o">==</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i5</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span> <span class="n">i5</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="o">;</span> <span class="n">i5</span> <span class="o">+=</span> <span class="mi">2</span><span class="o">)</span> <span class="o">{</span>
                    <span class="kt">char</span> <span class="n">c3</span> <span class="o">=</span> <span class="n">c</span><span class="o">(</span><span class="n">charAt</span><span class="o">,</span> <span class="n">i5</span><span class="o">)</span> <span class="o">^</span> <span class="n">c</span><span class="o">(</span><span class="n">c</span><span class="o">,</span> <span class="n">i5</span><span class="o">);</span>
                    <span class="k">if</span> <span class="o">(</span><span class="n">c3</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">charAt</span> <span class="o">=</span> <span class="n">a</span><span class="o">(</span><span class="n">charAt</span><span class="o">,</span> <span class="n">i5</span><span class="o">);</span>
                    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">c3</span> <span class="o">==</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">charAt</span> <span class="o">=</span> <span class="n">b</span><span class="o">(</span><span class="n">charAt</span><span class="o">,</span> <span class="n">i5</span><span class="o">);</span>
                    <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">i3</span> <span class="o">==</span> <span class="mi">2</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i6</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i6</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="o">;</span> <span class="n">i6</span><span class="o">++)</span> <span class="o">{</span>
                    <span class="kt">char</span> <span class="n">c4</span> <span class="o">=</span> <span class="n">c</span><span class="o">(</span><span class="n">charAt</span><span class="o">,</span> <span class="n">i6</span><span class="o">)</span> <span class="o">^</span> <span class="n">c</span><span class="o">(</span><span class="n">c</span><span class="o">,</span> <span class="n">i6</span><span class="o">);</span>
                    <span class="k">if</span> <span class="o">(</span><span class="n">c4</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">charAt</span> <span class="o">=</span> <span class="n">a</span><span class="o">(</span><span class="n">charAt</span><span class="o">,</span> <span class="n">i6</span><span class="o">);</span>
                    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">c4</span> <span class="o">==</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">charAt</span> <span class="o">=</span> <span class="n">b</span><span class="o">(</span><span class="n">charAt</span><span class="o">,</span> <span class="n">i6</span><span class="o">);</span>
                    <span class="o">}}}</span>
            <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">((</span><span class="kt">char</span><span class="o">)</span> <span class="o">(</span><span class="n">charAt</span> <span class="o">^</span> <span class="n">f823a</span><span class="o">));</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">sb</span><span class="o">.</span><span class="na">toString</span><span class="o">();}}</span>
</code></pre></div></div>

<p>So this is nice, some code that we can read with human comprehension.</p>

<p>Now focus on that XOR part at end of <code class="language-plaintext highlighter-rouge">d()</code> : <code class="language-plaintext highlighter-rouge">sb.append((char) (charAt ^ f823a));</code></p>

<p>here <code class="language-plaintext highlighter-rouge">f823a</code> is local variable whose value is set via <code class="language-plaintext highlighter-rouge">VaultApplication.java</code></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.sctf2020.vault101</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">android.app.Application</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">b.c.a.c</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">VaultApplication</span> <span class="kd">extends</span> <span class="nc">Application</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">();</span>

<span class="err">\\</span> <span class="no">SET</span> <span class="no">VALUE</span> <span class="no">FOR</span> <span class="no">XOR</span> <span class="no">KEY</span> <span class="no">IN</span> <span class="n">c</span><span class="o">.</span><span class="na">java</span>
        <span class="n">c</span><span class="o">.</span><span class="na">f823a</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Okay we as it’s not dynamic so we can skip this class and hardcode the value for <code class="language-plaintext highlighter-rouge">f823a</code> in our recreation of this algorithm</p>

<h3 id="recreating-the-algo-for-de-obfuscation">Recreating the Algo for de-obfuscation</h3>

<p><img src="/assets/images/sctf/start.jpg" alt="" /></p>

<p><em>I really hope de-obfuscation is valid techinical term</em></p>

<p>So this is simple and here is my implementation for it:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.x64mayhem</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.crypto.BadPaddingException</span><span class="o">;</span><span class="kn">import</span> <span class="nn">javax.crypto.Cipher</span><span class="o">;</span><span class="kn">import</span> <span class="nn">javax.crypto.IllegalBlockSizeException</span><span class="o">;</span><span class="kn">import</span> <span class="nn">javax.crypto.NoSuchPaddingException</span><span class="o">;</span><span class="kn">import</span> <span class="nn">javax.crypto.spec.IvParameterSpec</span><span class="o">;</span><span class="kn">import</span> <span class="nn">javax.crypto.spec.SecretKeySpec</span><span class="o">;</span><span class="kn">import</span> <span class="nn">java.io.UnsupportedEncodingException</span><span class="o">;</span><span class="kn">import</span> <span class="nn">java.lang.reflect.Array</span><span class="o">;</span><span class="kn">import</span> <span class="nn">java.security.InvalidAlgorithmParameterException</span><span class="o">;</span><span class="kn">import</span> <span class="nn">java.security.InvalidKeyException</span><span class="o">;</span><span class="kn">import</span> <span class="nn">java.security.NoSuchAlgorithmException</span><span class="o">;</span><span class="kn">import</span> <span class="nn">java.util.Base64</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IllegalAccessException</span><span class="o">,</span> <span class="nc">UnsupportedEncodingException</span> <span class="o">{</span>
     <span class="c1">//TOOL FOR DECODING INSTRUCTIONS</span>
       <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span>
            <span class="c1">//HERE YOU CAN PUT ANY D() CALL TO DECRYPT IT </span>

               <span class="n">d</span><span class="o">(</span><span class="s">"&gt;JÂ0ûDwù¯0Õ´zhÝ!ë\u000ff"</span><span class="o">,</span> <span class="o">-</span><span class="mi">989022505</span><span class="o">)</span>
       
       <span class="o">);}</span>

    <span class="c1">//WE SET THIS XOR KEY TO 1 AND REMOVE THAT CLASS </span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="no">INTGET</span><span class="o">=</span><span class="mi">1</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">char</span> <span class="nf">a</span><span class="o">(</span><span class="kt">char</span> <span class="n">c</span><span class="o">,</span> <span class="kt">int</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span><span class="k">return</span> <span class="o">(</span><span class="kt">char</span><span class="o">)</span> <span class="o">(</span><span class="n">c</span> <span class="o">&amp;</span> <span class="o">((</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="o">)</span> <span class="o">^</span> <span class="mi">65535</span><span class="o">));}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">char</span> <span class="nf">b</span><span class="o">(</span><span class="kt">char</span> <span class="n">c</span><span class="o">,</span> <span class="kt">int</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span><span class="k">return</span> <span class="o">(</span><span class="kt">char</span><span class="o">)</span> <span class="o">(</span><span class="n">c</span> <span class="o">|</span> <span class="o">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="o">));}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">char</span> <span class="nf">c</span><span class="o">(</span><span class="kt">char</span> <span class="n">c</span><span class="o">,</span> <span class="kt">int</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span><span class="k">return</span> <span class="o">(</span><span class="kt">char</span><span class="o">)</span> <span class="o">((</span><span class="n">c</span> <span class="o">&amp;</span> <span class="o">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="o">))</span> <span class="o">&gt;&gt;</span> <span class="n">i</span><span class="o">);}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">d</span><span class="o">(</span><span class="nc">CharSequence</span> <span class="n">charSequence</span><span class="o">,</span> <span class="kt">int</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">StringBuilder</span> <span class="n">sb</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span><span class="k">return</span> <span class="n">sb</span><span class="o">.</span><span class="na">toString</span><span class="o">();}</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i2</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i2</span> <span class="o">&lt;</span> <span class="n">charSequence</span><span class="o">.</span><span class="na">length</span><span class="o">();</span> <span class="n">i2</span><span class="o">++)</span> <span class="o">{</span>
            <span class="kt">char</span> <span class="n">charAt</span> <span class="o">=</span> <span class="n">charSequence</span><span class="o">.</span><span class="na">charAt</span><span class="o">(</span><span class="n">i2</span><span class="o">);</span>
            <span class="kt">char</span> <span class="n">c</span> <span class="o">=</span> <span class="o">(</span><span class="kt">char</span><span class="o">)</span> <span class="o">(</span><span class="n">i</span> <span class="o">&gt;&gt;</span> <span class="o">(</span><span class="n">i2</span> <span class="o">%</span> <span class="mi">4</span><span class="o">));</span>
            <span class="kt">int</span> <span class="n">i3</span> <span class="o">=</span> <span class="n">i2</span> <span class="o">%</span> <span class="mi">3</span><span class="o">;</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">i3</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i4</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i4</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="o">;</span> <span class="n">i4</span> <span class="o">+=</span> <span class="mi">2</span><span class="o">)</span> <span class="o">{</span>
                    <span class="kt">char</span> <span class="n">c2</span> <span class="o">=</span> <span class="o">(</span><span class="kt">char</span><span class="o">)</span> <span class="o">(</span><span class="n">c</span><span class="o">(</span><span class="n">charAt</span><span class="o">,</span> <span class="n">i4</span><span class="o">)</span> <span class="o">^</span> <span class="n">c</span><span class="o">(</span><span class="n">c</span><span class="o">,</span> <span class="n">i4</span><span class="o">));</span>
                    <span class="k">if</span> <span class="o">(</span><span class="n">c2</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">charAt</span> <span class="o">=</span> <span class="n">a</span><span class="o">(</span><span class="n">charAt</span><span class="o">,</span> <span class="n">i4</span><span class="o">);</span>
                    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">c2</span> <span class="o">==</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">charAt</span> <span class="o">=</span> <span class="n">b</span><span class="o">(</span><span class="n">charAt</span><span class="o">,</span> <span class="n">i4</span><span class="o">);</span>
                    <span class="o">}}</span>
            <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">i3</span> <span class="o">==</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i5</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span> <span class="n">i5</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="o">;</span> <span class="n">i5</span> <span class="o">+=</span> <span class="mi">2</span><span class="o">)</span> <span class="o">{</span>
                    <span class="kt">char</span> <span class="n">c3</span> <span class="o">=</span> <span class="o">(</span><span class="kt">char</span><span class="o">)</span> <span class="o">(</span><span class="n">c</span><span class="o">(</span><span class="n">charAt</span><span class="o">,</span> <span class="n">i5</span><span class="o">)</span> <span class="o">^</span> <span class="n">c</span><span class="o">(</span><span class="n">c</span><span class="o">,</span> <span class="n">i5</span><span class="o">));</span>
                    <span class="k">if</span> <span class="o">(</span><span class="n">c3</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">charAt</span> <span class="o">=</span> <span class="n">a</span><span class="o">(</span><span class="n">charAt</span><span class="o">,</span> <span class="n">i5</span><span class="o">);</span>
                    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">c3</span> <span class="o">==</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">charAt</span> <span class="o">=</span> <span class="n">b</span><span class="o">(</span><span class="n">charAt</span><span class="o">,</span> <span class="n">i5</span><span class="o">);</span>
                    <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">i3</span> <span class="o">==</span> <span class="mi">2</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i6</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i6</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="o">;</span> <span class="n">i6</span><span class="o">++)</span> <span class="o">{</span>
                    <span class="kt">char</span> <span class="n">c4</span> <span class="o">=</span> <span class="o">(</span><span class="kt">char</span><span class="o">)</span> <span class="o">(</span><span class="n">c</span><span class="o">(</span><span class="n">charAt</span><span class="o">,</span> <span class="n">i6</span><span class="o">)</span> <span class="o">^</span> <span class="n">c</span><span class="o">(</span><span class="n">c</span><span class="o">,</span> <span class="n">i6</span><span class="o">));</span>
                    <span class="k">if</span> <span class="o">(</span><span class="n">c4</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">charAt</span> <span class="o">=</span> <span class="n">a</span><span class="o">(</span><span class="n">charAt</span><span class="o">,</span> <span class="n">i6</span><span class="o">);</span>
                    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">c4</span> <span class="o">==</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">charAt</span> <span class="o">=</span> <span class="n">b</span><span class="o">(</span><span class="n">charAt</span><span class="o">,</span> <span class="n">i6</span><span class="o">)}}}</span>
            <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">((</span><span class="kt">char</span><span class="o">)</span> <span class="o">(</span><span class="n">charAt</span> <span class="o">^</span> <span class="no">INTGET</span><span class="o">));}</span>
        <span class="k">return</span> <span class="n">sb</span><span class="o">.</span><span class="na">toString</span><span class="o">();}}</span>
</code></pre></div></div>

<p>Now you can try this on your own.</p>

<p>The Idea is we will pass the <code class="language-plaintext highlighter-rouge">d()</code>  call and it will decrypt the gibberish and will give us something valid and it works…</p>

<p>Check this out ::</p>

<p><img src="/assets/images/sctf/1.png" alt="" /></p>

<p>Here we can see that the following code in obfuscated app :</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Object</span> <span class="n">invoke</span> <span class="o">=</span> <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"&gt;JÂ0ûDwù¯0Õ´zhÝ!ë\u000ff"</span><span class="o">,</span> <span class="o">-</span><span class="mi">989022505</span><span class="o">)).</span><span class="na">getMethod</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"rî:MGì0BSvn"</span><span class="o">,</span> <span class="o">-</span><span class="mi">2055632580</span><span class="o">),</span> <span class="k">new</span> <span class="nc">Class</span><span class="o">[]{</span><span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"+À0­0G¤nò\r3È6"</span><span class="o">,</span> <span class="mi">675347394</span><span class="o">))}).</span><span class="na">invoke</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">[]{</span><span class="n">c</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"QLÜkh^F,j_È\u0015%Yî Oukd"</span><span class="o">,</span> <span class="o">-</span><span class="mi">1263812037</span><span class="o">)});</span>
</code></pre></div></div>
<p>IS EQUIVALENT TO THIS -&gt;</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Object</span> <span class="n">invoke</span> <span class="o">=</span> <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">"javax.crypto.Cipher"</span><span class="o">).</span><span class="na">getMethod</span><span class="o">(</span><span class="s">"getInstance"</span><span class="o">,</span> 
	<span class="k">new</span> <span class="nc">Class</span><span class="o">[]{</span><span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">"java.lang.String"</span><span class="o">)}).</span><span class="na">invoke</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">[]{</span><span class="s">"AES/CBC/PKCS5Padding"</span><span class="o">});</span>
</code></pre></div></div>
<p>which actually is nothing but this -&gt;</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Cipher</span> <span class="no">AESCBC</span> <span class="o">=</span> <span class="nc">Cipher</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="s">"AES/CBC/PKCS5Padding"</span><span class="o">);</span>
</code></pre></div></div>

<p>So we are getting some code after all huh? NOICE !!</p>

<p><img src="/assets/images/sctf/noice.gif" alt="" /></p>

<p>So as we are not doing via dynamic approach, we have to decode all the <code class="language-plaintext highlighter-rouge">d()</code> calls like this… Don’t worry I will do it for ya, just a sec, till then you can grab some coffee ‘cause next part is actually amusingly simple :)</p>

<h3 id="de-obfuscaton-and-code-cleaning">De-Obfuscaton and Code Cleaning</h3>

<p><img src="/assets/images/sctf/clean.jpeg" alt="" /></p>

<p>Okay, so these are the java files after processing :</p>

<p><strong>b/c/a/a.java</strong></p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">b.c.a</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">a</span> <span class="o">{</span>
    <span class="cm">/* renamed from: a reason: collision with root package name */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">f821a</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">a</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">bArr</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">//DECRYPT </span>
        <span class="nc">Class</span><span class="o">&lt;</span><span class="n">a</span><span class="o">&gt;</span> <span class="n">cls</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="na">class</span><span class="o">;</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">Object</span> <span class="no">AESCBC</span> <span class="o">=</span> <span class="n">javax</span><span class="o">.</span><span class="na">crypto</span><span class="o">.</span><span class="na">Cipher</span><span class="o">.</span><span class="na">getInstance</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Class</span><span class="o">[]{</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">}).</span><span class="na">invoke</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">[]{</span><span class="no">AES</span><span class="o">/</span><span class="no">CBC</span><span class="o">/</span><span class="nc">PKCS5Padding</span><span class="o">});</span>
            <span class="nc">Object</span> <span class="n">newInstance</span> <span class="o">=</span> <span class="n">javax</span><span class="o">.</span><span class="na">crypto</span><span class="o">.</span><span class="na">spec</span><span class="o">.</span><span class="na">SecretKeySpec</span><span class="o">(</span><span class="n">cls</span><span class="o">.</span><span class="na">getDeclaredFields</span><span class="o">()[</span><span class="mi">0</span><span class="o">].</span><span class="na">get</span><span class="o">(</span><span class="kc">null</span><span class="o">),</span> <span class="s">"AES"</span><span class="o">);</span>
            <span class="nc">Object</span> <span class="nc">IvPARAM</span> <span class="o">=</span> <span class="n">javax</span><span class="o">.</span><span class="na">crypto</span><span class="o">.</span><span class="na">spec</span><span class="o">.</span><span class="na">IvParameterSpec</span><span class="o">(</span><span class="n">cls</span><span class="o">.</span><span class="na">getDeclaredFields</span><span class="o">()[</span><span class="mi">0</span><span class="o">].</span><span class="na">get</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
            <span class="nc">Object</span> <span class="no">DECRYPT</span> <span class="o">=</span> <span class="n">javax</span><span class="o">.</span><span class="na">crypto</span><span class="o">.</span><span class="na">Cipher</span><span class="o">.</span><span class="na">DECRYPT_MODE</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
            <span class="n">javax</span><span class="o">.</span><span class="na">crypto</span><span class="o">.</span><span class="na">Cipher</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">java</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">Key</span><span class="o">,</span> <span class="n">java</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">spec</span><span class="o">.</span><span class="na">AlgorithmParameterSpec</span><span class="o">).</span><span class="na">invoke</span><span class="o">(</span><span class="no">AESCBC</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">[]{</span><span class="no">DECRYPT</span><span class="o">,</span> <span class="n">newInstance</span><span class="o">,</span> <span class="nc">IvPARAM</span><span class="o">});</span>
            <span class="k">return</span> <span class="o">(</span><span class="kt">byte</span><span class="o">[])</span> <span class="n">javax</span><span class="o">.</span><span class="na">crypto</span><span class="o">.</span><span class="na">Cipher</span><span class="o">.</span><span class="na">doFinal</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Class</span><span class="o">[]{</span><span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">"[B"</span><span class="o">)}).</span><span class="na">invoke</span><span class="o">(</span><span class="no">AESCBC</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">[]{</span><span class="n">bArr</span><span class="o">});</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Throwable</span> <span class="n">unused</span><span class="o">)</span> <span class="o">{</span><span class="k">throw</span> <span class="k">new</span> <span class="nc">RuntimeException</span><span class="o">();}</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">b</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">bArr</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Class</span><span class="o">&lt;</span><span class="n">a</span><span class="o">&gt;</span> <span class="n">cls</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="na">class</span><span class="o">;</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">Object</span> <span class="no">AESCBC</span> <span class="o">=</span> <span class="n">javax</span><span class="o">.</span><span class="na">crypto</span><span class="o">.</span><span class="na">Cipher</span><span class="o">.</span><span class="na">getInstance</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Class</span><span class="o">[]{</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">}).</span><span class="na">invoke</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">[]{</span><span class="no">AES</span><span class="o">/</span><span class="no">CBC</span><span class="o">/</span><span class="nc">PKCS5Padding</span><span class="o">});</span>
            <span class="nc">Object</span> <span class="n">newInstance</span> <span class="o">=</span> <span class="n">javax</span><span class="o">.</span><span class="na">crypto</span><span class="o">.</span><span class="na">spec</span><span class="o">.</span><span class="na">SecretKeySpec</span><span class="o">.</span><span class="na">getConstructor</span><span class="o">(</span><span class="k">new</span> <span class="nc">Class</span><span class="o">[]{</span><span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">"[B"</span><span class="o">),</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">}).</span><span class="na">newInstance</span><span class="o">(</span><span class="k">new</span> <span class="nc">Object</span><span class="o">[]{</span><span class="n">cls</span><span class="o">.</span><span class="na">getDeclaredFields</span><span class="o">()[</span><span class="mi">0</span><span class="o">].</span><span class="na">get</span><span class="o">(</span><span class="kc">null</span><span class="o">),</span> <span class="no">AES</span><span class="o">});</span>
            <span class="nc">Object</span> <span class="nc">IvPARAM</span> <span class="o">=</span> <span class="n">javax</span><span class="o">.</span><span class="na">crypto</span><span class="o">.</span><span class="na">spec</span><span class="o">.</span><span class="na">IvParameterSpec</span><span class="o">.</span><span class="na">getConstructor</span><span class="o">(</span><span class="k">new</span> <span class="nc">Class</span><span class="o">[]{</span><span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">"[B"</span><span class="o">)}).</span><span class="na">newInstance</span><span class="o">(</span><span class="k">new</span> <span class="nc">Object</span><span class="o">[]{</span><span class="n">cls</span><span class="o">.</span><span class="na">getDeclaredFields</span><span class="o">()[</span><span class="mi">0</span><span class="o">].</span><span class="na">get</span><span class="o">(</span><span class="kc">null</span><span class="o">)});</span>
            <span class="nc">Object</span> <span class="no">ENCRYPT</span> <span class="o">=</span> <span class="n">javax</span><span class="o">.</span><span class="na">crypto</span><span class="o">.</span><span class="na">Cipher</span><span class="o">.</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="no">ENCRYPT_MODE</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
           <span class="n">javax</span><span class="o">.</span><span class="na">crypto</span><span class="o">.</span><span class="na">Cipher</span><span class="o">.</span><span class="na">init</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Class</span><span class="o">[]{(</span><span class="nc">Class</span><span class="o">)</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">TYPE</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="kc">null</span><span class="o">),</span> <span class="n">java</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">Key</span><span class="o">,</span> <span class="n">java</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">spec</span><span class="o">.</span><span class="na">AlgorithmParameterSpec</span><span class="o">}).</span><span class="na">invoke</span><span class="o">(</span><span class="no">AESCBC</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">[]{</span><span class="no">ENCRYPT</span><span class="o">,</span> <span class="n">newInstance</span><span class="o">,</span> <span class="nc">IvPARAM</span><span class="o">});</span>
            <span class="k">return</span> <span class="o">(</span><span class="kt">byte</span><span class="o">[])</span> <span class="n">javax</span><span class="o">.</span><span class="na">crypto</span><span class="o">.</span><span class="na">Cipher</span><span class="o">.</span><span class="na">doFinal</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Class</span><span class="o">[]{</span><span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">"[B"</span><span class="o">)}).</span><span class="na">invoke</span><span class="o">(</span><span class="no">AESCBC</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">[]{</span><span class="n">bArr</span><span class="o">});</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Throwable</span> <span class="n">unused</span><span class="o">)</span> <span class="o">{</span><span class="k">throw</span> <span class="k">new</span> <span class="nc">RuntimeException</span><span class="o">();}}}</span>
</code></pre></div></div>

<p><strong>VaultService.java</strong></p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.sctf2020.vault101</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.app.Service</span><span class="o">;</span><span class="kn">import</span> <span class="nn">android.content.Intent</span><span class="o">;</span><span class="kn">import</span> <span class="nn">android.os.IBinder</span><span class="o">;</span><span class="kn">import</span> <span class="nn">b.c.a.c</span><span class="o">;</span><span class="kn">import</span> <span class="nn">java.lang.reflect.Array</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">VaultService</span> <span class="kd">extends</span> <span class="nc">Service</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="nc">IBinder</span> <span class="n">f873b</span> <span class="o">=</span> <span class="k">new</span> <span class="n">b</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">b</span> <span class="kd">extends</span> <span class="n">b</span><span class="o">.</span><span class="na">c</span><span class="o">.</span><span class="na">a</span><span class="o">.</span><span class="na">b</span><span class="o">.</span><span class="na">a</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="n">f874a</span><span class="o">;</span>
        <span class="kd">public</span> <span class="nf">b</span><span class="o">(</span><span class="n">a</span> <span class="n">aVar</span><span class="o">)</span> <span class="o">{}</span>
        <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">a</span><span class="o">(</span><span class="nc">String</span> <span class="n">str</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">f874a</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span>
                <span class="k">this</span><span class="o">.</span><span class="na">f874a</span> <span class="o">=</span> <span class="n">i</span><span class="o">;</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="o">)</span> <span class="o">{</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
                <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">str</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
                <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                    <span class="kt">byte</span><span class="o">[]</span> <span class="no">ENCRYPTEDDATAINPUT</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="na">c</span><span class="o">.</span><span class="na">a</span><span class="o">.</span><span class="na">a</span><span class="o">.</span><span class="na">b</span><span class="o">((</span><span class="kt">byte</span><span class="o">[])</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(</span><span class="n">str</span><span class="o">));</span>
                    <span class="nc">Object</span> <span class="n">base64ENCDATA</span> <span class="o">=</span> <span class="n">android</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Base64</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="no">ENCRYPTEDDATAINPUT</span><span class="o">,</span> <span class="n">android</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Base64</span><span class="o">.</span><span class="na">NO_WRAP</span><span class="o">);</span>
                    <span class="nc">Object</span> <span class="no">OURENCRYPTEDDATA</span> <span class="o">=</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">.(</span><span class="n">base64ENCDATA</span><span class="o">)</span>
                    <span class="nc">Object</span> <span class="no">MAGIC</span> <span class="o">=</span> <span class="n">android</span><span class="o">.</span><span class="na">content</span><span class="o">.</span><span class="na">Context</span><span class="o">.</span><span class="na">getString</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Class</span><span class="o">[]{(</span><span class="nc">Class</span><span class="o">)</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Integer</span><span class="o">.</span><span class="na">TYPE</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="kc">null</span><span class="o">)}).</span><span class="na">invoke</span><span class="o">(</span><span class="nc">VaultService</span><span class="o">.</span><span class="na">this</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">[]{</span><span class="nc">Integer</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">magic</span><span class="o">)});</span>

                    <span class="k">return</span> <span class="o">((</span><span class="nc">Boolean</span><span class="o">)</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="no">MAGIC</span><span class="o">,</span><span class="no">OURENCRYPTEDDATA</span><span class="o">)</span>
                <span class="o">}}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Throwable</span> <span class="n">unused</span><span class="o">)</span> <span class="o">{</span><span class="k">throw</span> <span class="k">new</span> <span class="nc">RuntimeException</span><span class="o">();}</span> <span class="o">}}</span>
    <span class="kd">public</span> <span class="nc">IBinder</span> <span class="nf">onBind</span><span class="o">(</span><span class="nc">Intent</span> <span class="n">intent</span><span class="o">)</span> <span class="o">{</span><span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">f873b</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">Object</span> <span class="n">invoke</span> <span class="o">=</span> <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="n">android</span><span class="o">.</span><span class="na">content</span><span class="o">.</span><span class="na">Context</span><span class="o">.</span><span class="na">getResources</span><span class="o">,</span> <span class="kc">null</span><span class="o">).</span><span class="na">invoke</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
            <span class="nc">Object</span> <span class="no">KINDOFMAGIC</span> <span class="o">=</span> <span class="nc">String</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">array</span><span class="o">.</span><span class="na">kind_of_magic</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(</span><span class="no">KINDOFMAGIC</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>

                <span class="kt">int</span> <span class="n">length</span> <span class="o">=</span> <span class="nc">Array</span><span class="o">.</span><span class="na">getLength</span><span class="o">(</span><span class="no">KINDOFMAGIC</span><span class="o">);</span>
                <span class="kt">byte</span><span class="o">[]</span> <span class="no">NEWBYTEARRAYKOM</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="n">length</span><span class="o">];</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                    <span class="nc">Object</span> <span class="n">obj</span> <span class="o">=</span> <span class="nc">Array</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="no">KINDOFMAGIC</span><span class="o">,</span> <span class="n">i</span><span class="o">);</span>
                    <span class="nc">Object</span> <span class="n">invoke3</span> <span class="o">=</span> <span class="n">android</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Base64</span><span class="o">.</span><span class="na">decode</span><span class="o">(</span><span class="n">obj</span><span class="o">,</span> <span class="n">android</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Base64</span><span class="o">.</span><span class="na">NO_WRAP</span><span class="o">);</span>
                    <span class="nc">String</span> <span class="n">d</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="na">d</span><span class="o">((</span><span class="nc">CharSequence</span><span class="o">)</span><span class="n">invoke3</span><span class="o">,</span> <span class="n">i</span> <span class="o">^</span> <span class="mi">137</span><span class="o">);</span>
                    <span class="no">NEWBYTEARRAYKOM</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="o">(</span><span class="kt">byte</span><span class="o">)</span> <span class="o">(((</span><span class="nc">Character</span><span class="o">)</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">.</span><span class="na">charAt</span><span class="o">,</span><span class="n">invoke</span><span class="o">(</span><span class="n">d</span><span class="o">,</span> <span class="mi">0</span><span class="o">)).</span><span class="na">charValue</span><span class="o">();)}</span>
                <span class="n">b</span><span class="o">.</span><span class="na">c</span><span class="o">.</span><span class="na">a</span><span class="o">.</span><span class="na">a</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getDeclaredFields</span><span class="o">()[</span><span class="mi">0</span><span class="o">].</span><span class="na">set</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="no">NEWBYTEARRAYKOM</span><span class="o">);</span>
                <span class="k">return</span><span class="o">;</span>
            <span class="o">}</span><span class="k">throw</span> <span class="k">new</span> <span class="nc">NullPointerException</span><span class="o">();}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Throwable</span> <span class="n">unused</span><span class="o">)</span> <span class="o">{</span><span class="k">throw</span> <span class="k">new</span> <span class="nc">RuntimeException</span><span class="o">();}}}</span>
</code></pre></div></div>

<p>Now let’s solve !!</p>

<h3 id="recreating-the-aes-encryption-and-getting-the-flag">ReCreating the AES Encryption and Getting the Flag</h3>
<p>Ok so now we know enough to get the flag. and by analysing all the above codes we can see that application work something like this :</p>

<ul>
  <li>Get Input From User</li>
  <li>Pass that to VaultService.java</li>
  <li>Encrypt the Input in AES via <code class="language-plaintext highlighter-rouge">b/c/a/a.java:b(byte [])</code>
    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">byte</span><span class="o">[]</span> <span class="no">ENCRYPTEDDATAINPUT</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="na">c</span><span class="o">.</span><span class="na">a</span><span class="o">.</span><span class="na">a</span><span class="o">.</span><span class="na">b</span><span class="o">((</span><span class="kt">byte</span><span class="o">[])</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(</span><span class="n">str</span><span class="o">));</span>
</code></pre></div>    </div>
  </li>
  <li>Encode in Base64
    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Object</span> <span class="n">base64ENCDATA</span> <span class="o">=</span> <span class="n">android</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Base64</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="no">ENCRYPTEDDATAINPUT</span><span class="o">,</span> <span class="n">android</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Base64</span><span class="o">.</span><span class="na">NO_WRAP</span><span class="o">);</span>
<span class="nc">Object</span> <span class="no">OURENCRYPTEDDATA</span> <span class="o">=</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">.(</span><span class="n">base64ENCDATA</span><span class="o">);</span>
</code></pre></div>    </div>
  </li>
  <li>Get data from strings.xml with name tag = <code class="language-plaintext highlighter-rouge">magic</code>
    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Object</span> <span class="no">MAGIC</span> <span class="o">=</span> <span class="n">android</span><span class="o">.</span><span class="na">content</span><span class="o">.</span><span class="na">Context</span><span class="o">.</span><span class="na">getString</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Class</span><span class="o">[]{(</span><span class="nc">Class</span><span class="o">)</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Integer</span><span class="o">.</span><span class="na">TYPE</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="kc">null</span><span class="o">)}).</span><span class="na">invoke</span><span class="o">(</span><span class="nc">VaultService</span><span class="o">.</span><span class="na">this</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">[]{</span><span class="nc">Integer</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">magic</span><span class="o">)});</span>
</code></pre></div>    </div>
  </li>
  <li>Compare the data and return <code class="language-plaintext highlighter-rouge">True // False</code> boolean</li>
</ul>

<h4 id="aes">AES</h4>

<p>The encryption is actually simple,
This code generates the key :</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//GET STRING ARRAY FROM arrays.xml in values resource</span>
<span class="nc">Object</span> <span class="no">KINDOFMAGIC</span> <span class="o">=</span> <span class="nc">String</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">array</span><span class="o">.</span><span class="na">kind_of_magic</span><span class="o">);</span>

<span class="k">if</span> <span class="o">(</span><span class="no">KINDOFMAGIC</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>

<span class="kt">int</span> <span class="n">length</span> <span class="o">=</span> <span class="nc">Array</span><span class="o">.</span><span class="na">getLength</span><span class="o">(</span><span class="no">KINDOFMAGIC</span><span class="o">);</span>

<span class="kt">byte</span><span class="o">[]</span> <span class="no">NEWBYTEARRAYKOM</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="n">length</span><span class="o">];</span>

<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>

<span class="nc">Object</span> <span class="n">obj</span> <span class="o">=</span> <span class="nc">Array</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="no">KINDOFMAGIC</span><span class="o">,</span> <span class="n">i</span><span class="o">);</span>

<span class="c1">//B64 DECODE EACH ELEMENT OF THE ARRAY AND DECRYPT IT USING INBUILD d() FUNCTION</span>

<span class="nc">Object</span> <span class="n">invoke3</span> <span class="o">=</span> <span class="n">android</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Base64</span><span class="o">.</span><span class="na">decode</span><span class="o">(</span><span class="n">obj</span><span class="o">,</span> <span class="n">android</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Base64</span><span class="o">.</span><span class="na">NO_WRAP</span><span class="o">);</span>

<span class="c1">//XOR WITH '137' and DECRYPT VIA d()</span>
<span class="nc">String</span> <span class="n">d</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="na">d</span><span class="o">((</span><span class="nc">CharSequence</span><span class="o">)</span><span class="n">invoke3</span><span class="o">,</span> <span class="n">i</span> <span class="o">^</span> <span class="mi">137</span><span class="o">);</span>

<span class="c1">//APPEND ARRAY TO NEW MEMORY</span>
<span class="no">NEWBYTEARRAYKOM</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="o">(</span><span class="kt">byte</span><span class="o">)</span> <span class="o">(((</span><span class="nc">Character</span><span class="o">)</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">.</span><span class="na">charAt</span><span class="o">,</span><span class="n">invoke</span><span class="o">(</span><span class="n">d</span><span class="o">,</span> <span class="mi">0</span><span class="o">)).</span><span class="na">charValue</span><span class="o">();)</span>

<span class="o">}</span>
<span class="c1">//SET KEY IN THE ENCRYPTION CLASS FROM HERE</span>
<span class="n">b</span><span class="o">.</span><span class="na">c</span><span class="o">.</span><span class="na">a</span><span class="o">.</span><span class="na">a</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getDeclaredFields</span><span class="o">()[</span><span class="mi">0</span><span class="o">].</span><span class="na">set</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="no">NEWBYTEARRAYKOM</span><span class="o">);</span>

<span class="k">return</span><span class="o">;</span>
</code></pre></div></div>

<p>I have commented the above code so we don’t have to explain all again here, okay the new thing here is <code class="language-plaintext highlighter-rouge">class.getDeclaredFields[0].set()</code> call,</p>

<p>this is actually easy, <code class="language-plaintext highlighter-rouge">getDeclaredFields</code> will return a list of all declared vars in the class, we select the first one via <code class="language-plaintext highlighter-rouge">[0]</code> and then we use <code class="language-plaintext highlighter-rouge">set()</code> to change its value.</p>

<blockquote>
  <p>java is actually like programming in drunken English.</p>
</blockquote>

<p>Now moving on and getting the flag.</p>

<h4 id="flag-">FLAG !!!</h4>

<p>So to get the flag we can reverse the process on the saved string and will get it as we have all parameters of encoding and encryption.
So here is what I came up with.</p>

<blockquote>
  <p>WE KINDA CREATED WHOLE NEW IMPLEMENTATION OF AES AND DECRYPTION AS SOME OF THE ANDROID KEYWORDS WILL NOT WORK IN GENERAL JAVA.</p>
</blockquote>

<p><strong>SOLVE.java</strong></p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.x64mayhem</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.crypto.BadPaddingException</span><span class="o">;</span><span class="kn">import</span> <span class="nn">javax.crypto.Cipher</span><span class="o">;</span><span class="kn">import</span> <span class="nn">javax.crypto.IllegalBlockSizeException</span><span class="o">;</span><span class="kn">import</span> <span class="nn">javax.crypto.NoSuchPaddingException</span><span class="o">;</span><span class="kn">import</span> <span class="nn">javax.crypto.spec.IvParameterSpec</span><span class="o">;</span><span class="kn">import</span> <span class="nn">javax.crypto.spec.SecretKeySpec</span><span class="o">;</span><span class="kn">import</span> <span class="nn">java.io.UnsupportedEncodingException</span><span class="o">;</span><span class="kn">import</span> <span class="nn">java.lang.reflect.Array</span><span class="o">;</span><span class="kn">import</span> <span class="nn">java.security.InvalidAlgorithmParameterException</span><span class="o">;</span><span class="kn">import</span> <span class="nn">java.security.InvalidKeyException</span><span class="o">;</span><span class="kn">import</span> <span class="nn">java.security.NoSuchAlgorithmException</span><span class="o">;</span><span class="kn">import</span> <span class="nn">java.util.Base64</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IllegalAccessException</span><span class="o">,</span> <span class="nc">UnsupportedEncodingException</span> <span class="o">{</span>

       <span class="nc">String</span> <span class="no">KINDOFMAGIC</span><span class="o">[]={</span><span class="s">"UEBxWw=="</span><span class="o">,</span> <span class="s">"Sk5xVcOICw=="</span><span class="o">,</span> <span class="s">"bnRX"</span><span class="o">,</span> <span class="s">"S0BgWw=="</span><span class="o">,</span> <span class="s">"Nw=="</span><span class="o">,</span> <span class="s">"R0ZxRMOLElk="</span><span class="o">,</span> <span class="s">"TkJhWw=="</span><span class="o">,</span> <span class="s">"dHZHdcOl"</span><span class="o">,</span> <span class="s">"eWRNYQ=="</span><span class="o">,</span> <span class="s">"bHRSeMOi"</span><span class="o">,</span> <span class="s">"R05tVw=="</span><span class="o">,</span> <span class="s">"d2hScA=="</span><span class="o">,</span> <span class="s">"T0xyVMOADQ=="</span><span class="o">,</span> <span class="s">"f2pQ"</span><span class="o">,</span> <span class="s">"Q0xsVw=="</span><span class="o">,</span> <span class="s">"Nw=="</span><span class="o">};</span>

       <span class="nc">String</span> <span class="n">magic</span><span class="o">=</span> <span class="s">"7E3Q5fm4lBSKXaHTnlCO52VL/iY6f+hQQ35oeFphtZIu3pf0QuOEpFB5nTeg8GTx"</span><span class="o">;</span>

        <span class="c1">// TO GET THE KEY FROM KINDOFMAGIC ARRAY</span>
       <span class="kt">int</span> <span class="n">length</span> <span class="o">=</span> <span class="nc">Array</span><span class="o">.</span><span class="na">getLength</span><span class="o">(</span><span class="no">KINDOFMAGIC</span><span class="o">);</span>
       <span class="nc">Base64</span><span class="o">.</span><span class="na">Decoder</span> <span class="n">decode</span><span class="o">=</span><span class="nc">Base64</span><span class="o">.</span><span class="na">getDecoder</span><span class="o">();</span>
       <span class="kt">byte</span><span class="o">[]</span> <span class="no">NEWBYTEARRAYKOM</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="n">length</span><span class="o">];</span>
       <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
           <span class="nc">Object</span> <span class="n">obj</span> <span class="o">=</span> <span class="nc">Array</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="no">KINDOFMAGIC</span><span class="o">,</span><span class="n">i</span><span class="o">);</span>
           <span class="kt">byte</span><span class="o">[]</span> <span class="n">invoke3</span> <span class="o">=</span> <span class="n">decode</span><span class="o">.</span><span class="na">decode</span><span class="o">(</span><span class="n">obj</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
           <span class="nc">String</span> <span class="n">hmm</span> <span class="o">=</span> <span class="n">d</span><span class="o">(</span><span class="k">new</span> <span class="nc">String</span><span class="o">(</span><span class="n">invoke3</span><span class="o">,</span><span class="s">"UTF-8"</span><span class="o">),</span> <span class="n">i</span> <span class="o">^</span> <span class="mi">137</span><span class="o">);</span>
           <span class="no">NEWBYTEARRAYKOM</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="o">((</span><span class="kt">byte</span><span class="o">)</span> <span class="n">hmm</span><span class="o">.</span><span class="na">charAt</span><span class="o">(</span><span class="mi">0</span><span class="o">));}</span>
       <span class="c1">//SET THE KEY IN ENCRYPTION CLASS</span>
       <span class="n">a</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getDeclaredFields</span><span class="o">()[</span><span class="mi">0</span><span class="o">].</span><span class="na">set</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="no">NEWBYTEARRAYKOM</span><span class="o">);</span>
       <span class="nc">Base64</span><span class="o">.</span><span class="na">Decoder</span> <span class="n">decoder</span><span class="o">=</span><span class="nc">Base64</span><span class="o">.</span><span class="na">getDecoder</span><span class="o">();</span>
       <span class="kt">byte</span><span class="o">[]</span> <span class="n">bdecode</span><span class="o">=</span><span class="n">decoder</span><span class="o">.</span><span class="na">decode</span><span class="o">(</span><span class="n">magic</span><span class="o">);</span>
       <span class="c1">//CALL OUR IMPLEMENTATION OF a.java TO DECRYPT THE DATA</span>
       <span class="kt">byte</span><span class="o">[]</span> <span class="no">ANSWER</span> <span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="na">a</span><span class="o">(</span><span class="n">bdecode</span><span class="o">);</span>

       <span class="c1">//PRINT FLAG IN UTF-8 STRING</span>

       <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">new</span> <span class="nc">String</span><span class="o">(</span><span class="no">ANSWER</span><span class="o">));</span>
    
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="no">INTGET</span><span class="o">=</span><span class="mi">1</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">char</span> <span class="nf">a</span><span class="o">(</span><span class="kt">char</span> <span class="n">c</span><span class="o">,</span> <span class="kt">int</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span><span class="k">return</span> <span class="o">(</span><span class="kt">char</span><span class="o">)</span> <span class="o">(</span><span class="n">c</span> <span class="o">&amp;</span> <span class="o">((</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="o">)</span> <span class="o">^</span> <span class="mi">65535</span><span class="o">));}</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">char</span> <span class="nf">b</span><span class="o">(</span><span class="kt">char</span> <span class="n">c</span><span class="o">,</span> <span class="kt">int</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span><span class="k">return</span> <span class="o">(</span><span class="kt">char</span><span class="o">)</span> <span class="o">(</span><span class="n">c</span> <span class="o">|</span> <span class="o">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="o">));}</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">char</span> <span class="nf">c</span><span class="o">(</span><span class="kt">char</span> <span class="n">c</span><span class="o">,</span> <span class="kt">int</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span> <span class="k">return</span> <span class="o">(</span><span class="kt">char</span><span class="o">)</span> <span class="o">((</span><span class="n">c</span> <span class="o">&amp;</span> <span class="o">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="o">))</span> <span class="o">&gt;&gt;</span> <span class="n">i</span><span class="o">);}</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">d</span><span class="o">(</span><span class="nc">CharSequence</span> <span class="n">charSequence</span><span class="o">,</span> <span class="kt">int</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span>
<span class="nc">StringBuilder</span> <span class="n">sb</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">();</span>
<span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span><span class="k">return</span> <span class="n">sb</span><span class="o">.</span><span class="na">toString</span><span class="o">();}</span>
<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i2</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i2</span> <span class="o">&lt;</span> <span class="n">charSequence</span><span class="o">.</span><span class="na">length</span><span class="o">();</span> <span class="n">i2</span><span class="o">++)</span> <span class="o">{</span>
    <span class="kt">char</span> <span class="n">charAt</span> <span class="o">=</span> <span class="n">charSequence</span><span class="o">.</span><span class="na">charAt</span><span class="o">(</span><span class="n">i2</span><span class="o">);</span>
    <span class="kt">char</span> <span class="n">c</span> <span class="o">=</span> <span class="o">(</span><span class="kt">char</span><span class="o">)</span> <span class="o">(</span><span class="n">i</span> <span class="o">&gt;&gt;</span> <span class="o">(</span><span class="n">i2</span> <span class="o">%</span> <span class="mi">4</span><span class="o">));</span>
    <span class="kt">int</span> <span class="n">i3</span> <span class="o">=</span> <span class="n">i2</span> <span class="o">%</span> <span class="mi">3</span><span class="o">;</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">i3</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i4</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i4</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="o">;</span> <span class="n">i4</span> <span class="o">+=</span> <span class="mi">2</span><span class="o">)</span> <span class="o">{</span>
            <span class="kt">char</span> <span class="n">c2</span> <span class="o">=</span> <span class="o">(</span><span class="kt">char</span><span class="o">)</span> <span class="o">(</span><span class="n">c</span><span class="o">(</span><span class="n">charAt</span><span class="o">,</span> <span class="n">i4</span><span class="o">)</span> <span class="o">^</span> <span class="n">c</span><span class="o">(</span><span class="n">c</span><span class="o">,</span> <span class="n">i4</span><span class="o">));</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">c2</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">charAt</span> <span class="o">=</span> <span class="n">a</span><span class="o">(</span><span class="n">charAt</span><span class="o">,</span> <span class="n">i4</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">c2</span> <span class="o">==</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">charAt</span> <span class="o">=</span> <span class="n">b</span><span class="o">(</span><span class="n">charAt</span><span class="o">,</span> <span class="n">i4</span><span class="o">);}}</span>
    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">i3</span> <span class="o">==</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i5</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span> <span class="n">i5</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="o">;</span> <span class="n">i5</span> <span class="o">+=</span> <span class="mi">2</span><span class="o">)</span> <span class="o">{</span>
            <span class="kt">char</span> <span class="n">c3</span> <span class="o">=</span> <span class="o">(</span><span class="kt">char</span><span class="o">)</span> <span class="o">(</span><span class="n">c</span><span class="o">(</span><span class="n">charAt</span><span class="o">,</span> <span class="n">i5</span><span class="o">)</span> <span class="o">^</span> <span class="n">c</span><span class="o">(</span><span class="n">c</span><span class="o">,</span> <span class="n">i5</span><span class="o">));</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">c3</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">charAt</span> <span class="o">=</span> <span class="n">a</span><span class="o">(</span><span class="n">charAt</span><span class="o">,</span> <span class="n">i5</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">c3</span> <span class="o">==</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">charAt</span> <span class="o">=</span> <span class="n">b</span><span class="o">(</span><span class="n">charAt</span><span class="o">,</span> <span class="n">i5</span><span class="o">);}}</span>
    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">i3</span> <span class="o">==</span> <span class="mi">2</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i6</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i6</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="o">;</span> <span class="n">i6</span><span class="o">++)</span> <span class="o">{</span>
            <span class="kt">char</span> <span class="n">c4</span> <span class="o">=</span> <span class="o">(</span><span class="kt">char</span><span class="o">)</span> <span class="o">(</span><span class="n">c</span><span class="o">(</span><span class="n">charAt</span><span class="o">,</span> <span class="n">i6</span><span class="o">)</span> <span class="o">^</span> <span class="n">c</span><span class="o">(</span><span class="n">c</span><span class="o">,</span> <span class="n">i6</span><span class="o">));</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">c4</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">charAt</span> <span class="o">=</span> <span class="n">a</span><span class="o">(</span><span class="n">charAt</span><span class="o">,</span> <span class="n">i6</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">c4</span> <span class="o">==</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">charAt</span> <span class="o">=</span> <span class="n">b</span><span class="o">(</span><span class="n">charAt</span><span class="o">,</span> <span class="n">i6</span><span class="o">);</span>
            <span class="o">}}}</span>
    <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">((</span><span class="kt">char</span><span class="o">)</span> <span class="o">(</span><span class="n">charAt</span> <span class="o">^</span> <span class="no">INTGET</span><span class="o">));}</span>
<span class="k">return</span> <span class="n">sb</span><span class="o">.</span><span class="na">toString</span><span class="o">();}}</span>
</code></pre></div></div>

<p><strong>OUR <code class="language-plaintext highlighter-rouge">a.java</code></strong></p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.x64mayhem</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.crypto.BadPaddingException</span><span class="o">;</span><span class="kn">import</span> <span class="nn">javax.crypto.Cipher</span><span class="o">;</span><span class="kn">import</span> <span class="nn">javax.crypto.IllegalBlockSizeException</span><span class="o">;</span><span class="kn">import</span> <span class="nn">javax.crypto.NoSuchPaddingException</span><span class="o">;</span><span class="kn">import</span> <span class="nn">javax.crypto.spec.IvParameterSpec</span><span class="o">;</span><span class="kn">import</span> <span class="nn">javax.crypto.spec.SecretKeySpec</span><span class="o">;</span><span class="kn">import</span> <span class="nn">java.security.InvalidAlgorithmParameterException</span><span class="o">;</span><span class="kn">import</span> <span class="nn">java.security.InvalidKeyException</span><span class="o">;</span><span class="kn">import</span> <span class="nn">java.security.NoSuchAlgorithmException</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">a</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">f821a</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">a</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">bArr</span><span class="o">)</span> <span class="o">{</span>

        <span class="c1">//DECRYPT</span>

        <span class="nc">Class</span><span class="o">&lt;</span><span class="n">a</span><span class="o">&gt;</span> <span class="n">cls</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="na">class</span><span class="o">;</span>
        <span class="k">try</span> <span class="o">{</span>

            <span class="nc">Cipher</span> <span class="no">AESCBC</span> <span class="o">=</span> <span class="nc">Cipher</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="s">"AES/CBC/PKCS5Padding"</span><span class="o">);</span>
            <span class="nc">SecretKeySpec</span> <span class="n">keyspec</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SecretKeySpec</span><span class="o">((</span><span class="kt">byte</span><span class="o">[])</span> <span class="n">cls</span><span class="o">.</span><span class="na">getDeclaredFields</span><span class="o">()[</span><span class="mi">0</span><span class="o">].</span><span class="na">get</span><span class="o">(</span><span class="kc">null</span><span class="o">),</span> <span class="s">"AES"</span><span class="o">);</span>
            <span class="nc">IvParameterSpec</span> <span class="no">IVSPEC</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">IvParameterSpec</span><span class="o">((</span><span class="kt">byte</span><span class="o">[])</span> <span class="n">cls</span><span class="o">.</span><span class="na">getDeclaredFields</span><span class="o">()[</span><span class="mi">0</span><span class="o">].</span><span class="na">get</span><span class="o">(</span><span class="kc">null</span><span class="o">));</span>
            <span class="no">AESCBC</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="nc">Cipher</span><span class="o">.</span><span class="na">DECRYPT_MODE</span><span class="o">,</span> <span class="n">keyspec</span><span class="o">,</span> <span class="no">IVSPEC</span><span class="o">);</span>
            <span class="k">return</span> <span class="o">(</span><span class="kt">byte</span><span class="o">[])</span> <span class="no">AESCBC</span><span class="o">.</span><span class="na">doFinal</span><span class="o">(</span><span class="n">bArr</span><span class="o">);</span>

<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">NoSuchPaddingException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span><span class="n">ex</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();}</span>
<span class="k">catch</span> <span class="o">(</span><span class="nc">NoSuchAlgorithmException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span><span class="n">ex</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();}</span>
<span class="k">catch</span> <span class="o">(</span><span class="nc">InvalidAlgorithmParameterException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span><span class="n">ex</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();}</span>
<span class="k">catch</span> <span class="o">(</span><span class="nc">InvalidKeyException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span><span class="n">ex</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();}</span>
<span class="k">catch</span> <span class="o">(</span><span class="nc">BadPaddingException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span><span class="n">ex</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();}</span>
<span class="k">catch</span> <span class="o">(</span><span class="nc">IllegalBlockSizeException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span><span class="n">ex</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();}</span>
<span class="k">catch</span> <span class="o">(</span><span class="nc">IllegalAccessException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span><span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();}</span>

<span class="k">return</span> <span class="kc">null</span><span class="o">;}}</span>


</code></pre></div></div>

<p>Executing the above code will give us our love of CTFs: <code class="language-plaintext highlighter-rouge">SCTF{53CUr17Y_7Hr0U6H_085CUr17Y_15_N07_3N0U6H}</code></p>

<p><img src="/assets/images/sctf/2.png" alt="" /></p>

<p><img src="/assets/images/sctf/final.jpg" alt="" /></p>

<p>PHEW! That’s all for this one.. see ya all in the next one.</p>

<p>And you know the drill right? Till then… Stay Caffinenated Enough!</p>

<hr />

    



<div class="post-tags">
  
    
    <a href="/topics.html#ctf-writeup">
    
      <span class="icon">
        <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
      </span>&nbsp;<span class="tag-name">CTF Writeup</span>
    </a>
  
    
    <a href="/topics.html#ctf">
    
      <span class="icon">
        <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
      </span>&nbsp;<span class="tag-name">CTF</span>
    </a>
  
    
    <a href="/topics.html#frigidsec">
    
      <span class="icon">
        <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
      </span>&nbsp;<span class="tag-name">FrigidSec</span>
    </a>
  
</div>
  </div>

  
  <section class="comments">
    <h2>Comments</h2>
    
  <div id="disqus_thread">
    <button class="disqus-load" onClick="loadDisqusComments()">
      Load Comments
    </button>
  </div>
  <script>

  /**
  *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW
  *  TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
  *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT:s
  *  https://disqus.com/admin/universalcode/#configuration-variables
  */
  var disqus_config = function () {
    this.page.url = "http://localhost:4000/2020/08/18/sstf-vault-wtireup.html";
    this.page.identifier = "" ||
                           "http://localhost:4000/2020/08/18/sstf-vault-wtireup.html";
  }
  function loadDisqusComments() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = '//saketupadhyay.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  }
  </script>
  <noscript>
    Please enable JavaScript to view the
    <a href="https://disqus.com/?ref_noscript">comments powered by Disqus</a>.
  </noscript>



  </section>

  <section class="related">
  <h2>Related Posts</h2>
  <ul class="posts-list">
    
      <li>
        <h3>
          <a href="/2020/12/24/blogupdate0.html">
            Blog.update(0) - New additions and modifications.
            <small>24 Dec 2020</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2020/08/17/ascwg-impossible-dream.html">
            ASCWG CTF Impossible Dream Writeup
            <small>17 Aug 2020</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2020/08/17/ascwg-check.html">
            ASCWG CTF Check Writeup
            <small>17 Aug 2020</small>
          </a>
        </h3>
      </li>
    
  </ul>
</section>

</div>

    </main>

    <!-- Optional footer content -->

  </body>
</html>
